{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///(webpack)/buildin/harmony-module.js","webpack:///./src/common/Root/components/Header/index.tsx","webpack:///./src/common/Root/index.tsx","webpack:///./src/common/Root/screens/EditProfile/actionCreators.ts","webpack:///./src/common/Root/screens/EditProfile/apiService.ts","webpack:///./src/common/Root/screens/EditProfile/components/styled.ts","webpack:///./src/common/Root/screens/EditProfile/index.tsx","webpack:///./src/common/Root/screens/EditProfile/reducers.ts","webpack:///./src/common/Root/screens/EditProfile/sagas.ts","webpack:///./src/common/Root/screens/EditProfile/types.ts","webpack:///./src/common/Root/screens/EditProfile/validationSchema.ts","webpack:///./src/common/Root/screens/Login/components.ts","webpack:///./src/common/Root/screens/Login/index.tsx","webpack:///./src/common/Root/screens/Login/validationSchema.ts","webpack:///./src/common/Root/screens/Logout/index.tsx","webpack:///./src/common/Root/screens/Registration/index.tsx","webpack:///./src/common/Root/screens/Registration/validationSchema.ts","webpack:///./src/common/Root/screens/SingleUser/actionCreators.ts","webpack:///./src/common/Root/screens/SingleUser/apiService.ts","webpack:///./src/common/Root/screens/SingleUser/components/ArrowBack/index.tsx","webpack:///./src/common/Root/screens/SingleUser/components/styled.ts","webpack:///./src/common/Root/screens/SingleUser/index.tsx","webpack:///./src/common/Root/screens/SingleUser/reducers.ts","webpack:///./src/common/Root/screens/SingleUser/sagas.ts","webpack:///./src/common/Root/screens/SingleUser/types.ts","webpack:///./src/common/Root/screens/UserList/actionCreators.ts","webpack:///./src/common/Root/screens/UserList/apiService.ts","webpack:///./src/common/Root/screens/UserList/components/IsLoggedInUser/index.tsx","webpack:///./src/common/Root/screens/UserList/components/styled/index.ts","webpack:///./src/common/Root/screens/UserList/index.tsx","webpack:///./src/common/Root/screens/UserList/reducers.ts","webpack:///./src/common/Root/screens/UserList/sagas.ts","webpack:///./src/common/Root/screens/UserList/types.ts","webpack:///./src/common/actionCreators.ts","webpack:///./src/common/configureStore.ts","webpack:///./src/common/globalStyles.ts","webpack:///./src/common/rootReducer.ts","webpack:///./src/common/rootSaga.ts","webpack:///./src/common/shared/components/styled.ts","webpack:///./src/common/styledComponents.ts","webpack:///./src/common/theme.ts","webpack:///./src/common/types.ts","webpack:///./src/server/index.ts","webpack:///./src/server/libConfig/index.ts","webpack:///./src/server/libConfig/mongoose.ts","webpack:///./src/server/libConfig/passport.ts","webpack:///./src/server/models/User/index.ts","webpack:///./src/server/routes/index.ts","webpack:///./src/server/routes/ssr/index.tsx","webpack:///./src/server/routes/users/index.ts","webpack:///./src/server/server.ts","webpack:///external \"axios\"","webpack:///external \"config\"","webpack:///external \"cookie-parser\"","webpack:///external \"crypto\"","webpack:///external \"express\"","webpack:///external \"formik\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"lodash/pick\"","webpack:///external \"mongoose\"","webpack:///external \"passport\"","webpack:///external \"passport-jwt\"","webpack:///external \"path\"","webpack:///external \"polished\"","webpack:///external \"react\"","webpack:///external \"react-dom/server\"","webpack:///external \"react-hot-loader\"","webpack:///external \"react-redux\"","webpack:///external \"react-router\"","webpack:///external \"react-router-dom\"","webpack:///external \"redux\"","webpack:///external \"redux-saga\"","webpack:///external \"redux-saga/effects\"","webpack:///external \"serve-favicon\"","webpack:///external \"styled-components\"","webpack:///external \"yup\""],"names":["H","styled","header","theme","scale","second","rgba","colors","quaternary","UserInfo","section","Nav","nav","first","StyledLink","Header","props","includes","location","pathname","Main","MainInner","div","Root","loggedInUser","Registration","Login","Logout","UserList","SingleUser","EditProfile","mapStateToProps","state","hot","module","withRouter","connect","userFetchRequested","id","type","userFetchTypes","USER_FETCH_REQUESTED","userFetchSucceeded","user","USER_FETCH_SUCCEEDED","userFetchFailed","error","USER_FETCH_FAILED","userUpdateSucceeded","userUpdateTypes","USER_UPDATE_SUCCEEDED","fetchUserService","User","require","default","findById","publicFields","lean","then","_id","toString","CancelButton","BaseButton","extend","secondary","base","onSubmit","values","actions","match","params","setSubmitting","serverErrorMessage","axios","post","res","data","history","push","catch","err","setErrors","response","idUrlParam","users","length","initialValues","password","bind","errors","touched","isSubmitting","username","email","firstName","lastName","goBack","editPropfileReducer","action","requestInProgress","idx","findIndex","slice","fetchUserWorker","call","put","fetchUserWatcher","takeLatest","object","shape","string","min","max","required","StyledForm","InputBlock","DefaultUserMessage","formikBag","addLoggedInUser","replace","loggedOut","componentDidMount","removeLoggedInUser","setState","console","render","mapDispatchToProps","dispatch","bindActionCreators","fetchSingleUserRequested","fetchSingleUserTypes","FETCH_SINGLE_USER_REQUESTED","fetchSingleUserSucceeded","FETCH_SINGLE_USER_SUCCEEDED","fetchSingleUserFailed","FETCH_SINGLE_USER_FAILED","removeUser","removeUserTypes","REMOVE_USER","fetchSingleUser","delete","ArrowBack","width","height","tertiary","withTheme","Card","article","FullName","h2","Username","h3","Email","p","RegisteredSince","Buttons","third","fifth","EditButton","DeleteButton","withComponent","BackButton","fourth","constructor","test","createdAt","find","loggedInUserId","Date","toDateString","singleUserReducer","fetchSingleUserWorker","removeUserWorker","e","watchFetchSingleUser","all","usersFetchRequested","UsersFetchActionTypes","USERS_FETCH_REQUESTED","usersFetchSucceeded","USERS_FETCH_SUCCEEDED","usersFetchFailed","USERS_FETCH_FAILED","fetchUsers","map","ThisIsYou","IsLoggedInUser","userId","primary","mFirst","bold","userList","userListSaga","loggedInUserTypes","ADD_LOGGED_IN_USER","REMOVE_LOGGED_IN_USER","defaultState","configureStore","preloadedState","enhancers","sagaMiddleware","createSagaMiddleware","applyMiddleware","window","__REDUX_DEVTOOLS_EXTENSION__","store","createStore","compose","runSaga","run","close","rootReducer","userListReducer","editProfileReducer","rootSaga","fork","Title","h1","ServerErrorMessage","button","SubmitButton","ErrorMessage","Label","label","StyledField","BottomLink","BlockWrapper","css","injectGlobal","keyframes","ThemeProvider","sixth","modularScale","mSecond","app","listen","config","get","configurePassport","isDev","mongoose","connection","on","use","passport","initialize","options","jwtFromRequest","req","token","signedCookies","secretOrKey","payload","done","pick","userSchema","Schema","String","minlength","maxlength","trim","lowercase","unique","salt","set","statics","updateFields","filterPublicFields","userOrUsers","Array","isArray","rawUser","reduce","acc","field","filterUpdateFields","iterations","algorithm","pre","next","crypto","randomBytes","randB","pbkdf2","derivedKey","methods","checkPassword","Promise","resolve","reject","Error","model","assets","JSON","parse","filter","asset","authHandler","authenticate","session","info","SSRHandler","context","modules","sheet","localDefaultState","rootComp","originalUrl","url","redirect","status","html","getStyleTags","stringify","getState","renderToString","reverse","assetPath","join","send","router","Router","jwtAuth","cookieOptions","httpOnly","expires","now","Number","parseInt","signed","jwtOptions","expiresIn","validateUserIdParam","Types","ObjectId","isValid","statusCode","rawUsers","filteredUsers","json","body","key","userDoc","save","updatedUserDoc","findByIdAndUpdate","new","newUser","jwt","sign","cookie","findOne","isCorrect","toObject","clearCookie","findByIdAndRemove","express","disable","serveFavicon","path","static","cookieParser","urlencoded","extended","configureLibs","errorHandler","message"],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;ACnEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;ACvBA;AACA;AACA;AACA;AAIA,MAAMA,IAAI,wDAAAC,CAAOC,MAAO;;cAEV,CAAC;AAAEC;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYC,MAAO;;;;2BAIrB,CAAC;AAAEF;AAAF,CAAD,KAAe,qDAAAG,CAAKH,MAAMI,MAAN,CAAaC,UAAlB,EAA8B,IAA9B,CAAoC;CAN9E;AASA,MAAMC,WAAW,wDAAAR,CAAOS,OAAQ,EAAhC;AAEA,MAAMC,MAAM,wDAAAV,CAAOW,GAAI;cACT,CAAC;AAAET;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYS,KAAM;CAD/C;AAIA,MAAMC,aAAa,gEAAAb,CAAO,qDAAP,CAAa;;;;;;CAAhC;;AAQA,MAAMc,SAA4BC,SAAS;AACzC,MAAI,CAAC,QAAD,EAAW,eAAX,EAA4BC,QAA5B,CAAqCD,MAAME,QAAN,CAAeC,QAApD,CAAJ,EACE,OAAO,IAAP;AAEF,SACE,2DAAC,CAAD,QACE,2DAAC,QAAD,OADF,EAEE,2DAAC,GAAD,QACE,2DAAC,UAAD;AAAY,QAAG;AAAf,cADF,CAFF,CADF;AAQD,CAZD;;AAcA,+DAAeJ,MAAf,E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5CA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA,MAAMK,OAAO,gEAAAnB,CAA2B,MAA3B,CAAmC;eACjC,CAAC;AAAEE;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYC,MAAO;;sBAE3B,CAAC;AAAEF,OAAF;AAASe;AAAT,CAAD,KAAyB;AAC3C,SAAO,CAAC,CAAC,QAAD,EAAW,eAAX,EAA4BD,QAA5B,CAAqCC,SAASC,QAA9C,CAAD,GACH,qDAAAb,CAAKH,MAAMI,MAAN,CAAaC,UAAlB,EAA8B,IAA9B,CADG,GAEH,OAFJ;AAGD,CAAC;;CAPJ;AAWA,MAAMa,YAAY,wDAAApB,CAAOqB,GAAI;;;CAA7B;;AAKA,MAAMC,OAAwBP,SAC5B,2DAAC,8DAAD;AAAe,SAAO,+CAAAb;AAAtB,GACE,wHACE,2DAAC,2DAAD;AAAQ,gBAAca,MAAMQ,YAA5B;AAA0C,YAAUR,MAAME;AAA1D,EADF,EAEE,2DAAC,IAAD;AAAM,YAAUF,MAAME;AAAtB,GACE,2DAAC,SAAD,QACE,2DAAC,uDAAD,QACE,2DAAC,sDAAD;AAAO,aAAP;AAAa,QAAK,eAAlB;AAAkC,aAAW,6DAAAO;AAA7C,EADF,EAEE,2DAAC,sDAAD;AAAO,aAAP;AAAa,QAAK,QAAlB;AAA2B,aAAW,sDAAAC;AAAtC,EAFF,EAGE,2DAAC,sDAAD;AAAO,aAAP;AAAa,QAAK,SAAlB;AAA4B,aAAW,wDAAAC;AAAvC,EAHF,EAIE,2DAAC,sDAAD;AAAO,aAAP;AAAa,QAAK,GAAlB;AAAsB,aAAW,yDAAAC;AAAjC,EAJF,EAKE,2DAAC,sDAAD;AAAO,aAAP;AAAa,QAAK,MAAlB;AAAyB,aAAW,2DAAAC;AAApC,EALF,EAME,2DAAC,sDAAD;AAAO,aAAP;AAAa,QAAK,WAAlB;AAA8B,aAAW,6DAAAC;AAAzC,EANF,EAOE,2DAAC,sDAAD;AAAO,UAAQd,SAAS;AAAxB,EAPF,CADF,CADF,CAFF,CADF,CADF;;AAqBA,SAASe,eAAT,CAAyBC,KAAzB,EAA8C;AAC5C,SAAO;AACLR,kBAAcQ,MAAMR;AADf,GAAP;AAGD;;AAED,+DAAe,4DAAAS,CAAIC,MAAJ,EAAY,mEAAAC,CAAW,2DAAAC,CAAQL,eAAR,EAAyBR,IAAzB,CAAX,CAAZ,CAAf,E;;;;;;;;;;;;;;;;;;;AC/DA;AASO,MAAMc,qBAAuDC,MAAM;AACxE,SAAO;AACLC,UAAM,qDAAAC,CAAeC,oBADhB;AAELH;AAFK,GAAP;AAID,CALM;AAOA,MAAMI,qBAAuDC,QAAQ;AAC1E,SAAO;AACLJ,UAAM,qDAAAC,CAAeI,oBADhB;AAELD;AAFK,GAAP;AAID,CALM;AAOA,MAAME,kBAAiDC,SAAS;AACrE,SAAO;AACLP,UAAM,qDAAAC,CAAeO,iBADhB;AAELD;AAFK,GAAP;AAID,CALM;AAOA,MAAME,sBAAyDL,QAAQ;AAC5E,SAAO;AACLJ,UAAM,sDAAAU,CAAgBC,qBADjB;AAELP;AAFK,GAAP;AAID,CALM,C;;;;;;;;;;;;AC1BP;AAAA,MAAMQ,mBAAyCb,MAAM;AACnD,MAAI,IAAJ,EAAgB;AACd,UAAMc,OAAO,mBAAAC,CAAQ,yEAAR,EACVC,OADH;;AAGA,WAAOF,KAAKG,QAAL,CAAcjB,EAAd,EAAkBc,KAAKI,YAAvB,EACJC,IADI,GAEJC,IAFI,CAEEf,IAAD,IAAiB;AACrBA,WAAKgB,GAAL,GAAWhB,KAAKgB,GAAL,CAASC,QAAT,EAAX;AACA,aAAOjB,IAAP;AACD,KALI,CAAP;AAMD;AACF,CAZD;;AAcA,+DAAeQ,gBAAf,E;;;;;;;;;;;;;;;AChBA;AAEO,MAAMU,eAAe,4DAAAC,CAAWC,MAAO;sBACxB,CAAC;AAAE5D;AAAF,CAAD,KAAeA,MAAMI,MAAN,CAAayD,SAAU;kBAC1C,CAAC;AAAE7D;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAY6D,IAAK;CAF3C,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACJP;AAEA;AACA;AACA;AACA;AAEA;AAYA;AACA;AACA;;AAIA,SAASC,QAAT,CACElD,KADF,EAEEmD,MAFF,EAGEC,OAHF,EAIE;AACA,QAAM;AACJC,WAAO;AACLC,cAAQ;AAAEhC;AAAF;AADH;AADH,MAIFtB,KAJJ;AAKAoD,UAAQG,aAAR,CAAsB,IAAtB;AACA,SAAOJ,OAAOK,kBAAd;AACAC,EAAA,4CAAAA,CACGC,IADH,CACS,QAAOpC,EAAG,OADnB,EAC2B6B,MAD3B,EAEGT,IAFH,CAEQiB,OAAO;AACXP,YAAQG,aAAR,CAAsB,KAAtB;AACAvD,UAAMgC,mBAAN,CAA0B2B,IAAIC,IAA9B;AACA5D,UAAM6D,OAAN,CAAcC,IAAd,CAAoB,IAAGxC,EAAG,EAA1B;AACD,GANH,EAOGyC,KAPH,CAOSC,OAAO;AACZZ,YAAQG,aAAR,CAAsB,KAAtB;AACAH,YAAQa,SAAR,CAAkB;AAAET,0BAAoBQ,IAAIE,QAAJ,CAAaN;AAAnC,KAAlB;AACD,GAVH;AAWD;;AAED,MAAM9C,cAAsCd,SAAS;AACnD,QAAM;AAAEsB,QAAI6C;AAAN,MAAqBnE,MAAMqD,KAAN,CAAYC,MAAvC;AACA,MAAI,CAACtD,MAAMoE,KAAN,CAAYC,MAAjB,EAAyBrE,MAAMqB,kBAAN,CAAyB8C,UAAzB;;AAEzB,QAAMG;AACJd,wBAAoB,IADhB;AAEJe,cAAU;AAFN,KAGDvE,MAAMQ,YAHL,CAAN;;AAMA,SACE,2DAAC,6CAAD;AACE,mBAAe8D,aADjB;AAEE,sBAAkB,yDAFpB;AAGE,cAAUpB,SAASsB,IAAT,CAAc,IAAd,EAAoBxE,KAApB,CAHZ;AAIE,YAAQ,CAAC;AAAEyE,YAAF;AAAUC,aAAV;AAAmBC;AAAnB,KAAD,KAAuC;AAC7C,aAAO,CAAC3E,MAAMQ,YAAP,GACL,2DAAC,yDAAD;AAAU,YAAG;AAAb,QADK,GAGL,wHACE,2DAAC,uDAAD,uBADF,EAEGiE,OAAOjB,kBAAP,IACC,2DAAC,oEAAD,0BACiBiB,OAAOjB,kBADxB,CAHJ,EAOE,2DAAC,4DAAD,QACE,2DAAC,4DAAD,QACE,2DAAC,uDAAD;AAAO,iBAAQ;AAAf,sBACW,6EADX,CADF,EAIE,sEAJF,EAKE,2DAAC,6DAAD;AAAa,cAAK,MAAlB;AAAyB,cAAK,UAA9B;AAAyC,YAAG;AAA5C,QALF,EAME,2DAAC,8DAAD,QACGkB,QAAQE,QAAR,IAAoBH,OAAOG,QAA3B,IAAuCH,OAAOG,QADjD,CANF,CADF,EAWE,2DAAC,4DAAD,QACE,2DAAC,uDAAD;AAAO,iBAAQ;AAAf,mBACQ,6EADR,CADF,EAIE,sEAJF,EAKE,2DAAC,6DAAD;AAAa,cAAK,OAAlB;AAA0B,cAAK,OAA/B;AAAuC,YAAG;AAA1C,QALF,EAME,2DAAC,8DAAD,QACGF,QAAQG,KAAR,IAAiBJ,OAAOI,KAAxB,IAAiCJ,OAAOI,KAD3C,CANF,CAXF,EAqBE,2DAAC,4DAAD,QACE,2DAAC,uDAAD;AAAO,iBAAQ;AAAf,sBADF,EAEE,sEAFF,EAGE,2DAAC,6DAAD;AAAa,cAAK,MAAlB;AAAyB,cAAK,WAA9B;AAA0C,YAAG;AAA7C,QAHF,EAIE,2DAAC,8DAAD,QACGH,QAAQI,SAAR,IAAqBL,OAAOK,SAA5B,IAAyCL,OAAOK,SADnD,CAJF,CArBF,EA6BE,2DAAC,4DAAD,QACE,2DAAC,uDAAD;AAAO,iBAAQ;AAAf,qBADF,EAEE,sEAFF,EAGE,2DAAC,6DAAD;AAAa,cAAK,MAAlB;AAAyB,cAAK,UAA9B;AAAyC,YAAG;AAA5C,QAHF,EAIE,2DAAC,8DAAD,QACGJ,QAAQK,QAAR,IAAoBN,OAAOM,QAA3B,IAAuCN,OAAOM,QADjD,CAJF,CA7BF,EAqCE,2DAAC,8DAAD,QACE,2DAAC,4DAAD,QACE,2DAAC,uDAAD;AAAO,iBAAQ;AAAf,sBACW,6EADX,CADF,EAIE,sEAJF,EAKE,2DAAC,6DAAD;AAAa,cAAK,UAAlB;AAA6B,cAAK,UAAlC;AAA6C,YAAG;AAAhD,QALF,EAME,2DAAC,8DAAD,QACGL,QAAQH,QAAR,IAAoBE,OAAOF,QAA3B,IAAuCE,OAAOF,QADjD,CANF,CADF,CArCF,EAiDE,2DAAC,8DAAD,QACE,2DAAC,+DAAD;AACE,iBAAS,MAAM;AACbvE,gBAAM6D,OAAN,CAAcmB,MAAd;AACD;AAHH,kBADF,EAQE,2DAAC,8DAAD;AAAc,cAAK,QAAnB;AAA4B,kBAAUL;AAAtC,kBARF,CAjDF,CAPF,CAHF;AA0ED;AA/EH,IADF;AAmFD,CA7FD;;AA+FA,MAAMvB,UAAU;AACd/B,EAAA,sFADc;AAEdW,EAAA,wFAAAA;AAFc,CAAhB;AAKA,+DAAe,2DAAAZ,CAAQJ,SAASA,KAAjB,EAAwBoC,OAAxB,EAAiCtC,WAAjC,CAAf,E;;;;;;;;;;;;;;;;;;;ACrJA;AAOe,SAASmE,mBAAT,CACbjE,KADa,EAEbkE,MAFa,EAGb;AACA,UAAQA,OAAO3D,IAAf;AACE,SAAK,qDAAAC,CAAeC,oBAApB;AACE,+BAAYT,KAAZ;AAAmBmE,2BAAmB;AAAtC;;AACF,SAAK,qDAAA3D,CAAeI,oBAApB;AACE,+BACKZ,KADL;AAEEmE,2BAAmB,KAFrB;AAGEf,eAAO,CAAC,GAAGpD,MAAMoD,KAAV,EAAiBc,OAAOvD,IAAxB;AAHT;;AAKF,SAAK,qDAAAH,CAAeO,iBAApB;AACE,+BAAYf,KAAZ;AAAmBmE,2BAAmB,KAAtC;AAA6CrD,eAAOoD,OAAOpD;AAA3D;;AACF,SAAK,sDAAAG,CAAgBC,qBAArB;AACE,YAAM;AAAEkC;AAAF,UAAYpD,KAAlB;AACA,UAAIoE,MAAMhB,MAAMiB,SAAN,CAAgB1D,QAAQA,KAAKgB,GAAL,KAAauC,OAAOvD,IAAP,CAAYgB,GAAjD,CAAV;AACA,+BACK3B,KADL;AAEEmE,2BAAmB,KAFrB;AAGEf,eAAO,CAAC,GAAGA,MAAMkB,KAAN,CAAY,CAAZ,EAAeF,GAAf,CAAJ,EAAyBF,OAAOvD,IAAhC,EAAsC,GAAGyC,MAAMkB,KAAN,CAAY,EAAEF,GAAd,CAAzC,CAHT;AAIE5E,sBAAc0E,OAAOvD;AAJvB;;AAMF;AACE,aAAOX,KAAP;AArBJ;AAuBD,C;;;;;;;;;;;;;;;;;;;;ACnCD;AAEA;AACA;AAEA;AAEO,UAAUuE,eAAV,CAA0B;AAAEjE;AAAF,CAA1B,EAA6D;AAClE,MAAI;AACF,UAAMK,OAAO,MAAM,+DAAA6D,CAAK,mDAAL,EAA0BlE,EAA1B,CAAnB;AACA,UAAM,8DAAAmE,CAAI,0EAAA/D,CAAmBC,IAAnB,CAAJ,CAAN;AACD,GAHD,CAGE,OAAOG,KAAP,EAAc;AACd,UAAM,8DAAA2D,CAAI,uEAAA5D,CAAgBC,KAAhB,CAAJ,CAAN;AACD;AACF;AAEc,UAAU4D,gBAAV,GAA6B;AAC1C,QAAM,qEAAAC,CAAW,qDAAAnE,CAAeC,oBAA1B,EAAgD8D,eAAhD,CAAN;AACD,C;;;;;;;;;;;;;;ACHD;AAAA;;;AAIA,IAAY/D,cAAZ;;WAAYA,c;AAAAA,gB;AAAAA,gB;AAAAA,gB;GAAAA,c,KAAAA,c;;AAiCZ;;;AAIA,IAAYS,eAAZ;;WAAYA,e;AAAAA,iB;GAAAA,e,KAAAA,e;;;;;;;;;;;;;;;ACxDZ;AAEA,+DAAe,kDAAA2D,GAASC,KAAT,CAAe;AAC5BjB,YAAU,kDAAAkB,GACPC,GADO,CACH,CADG,EAEPC,GAFO,CAEH,EAFG,EAGPC,QAHO,EADkB;AAK5BpB,SAAO,kDAAAiB,GACJjB,KADI,GAEJmB,GAFI,CAEA,EAFA,EAGJC,QAHI,EALqB;AAS5BnB,aAAW,kDAAAgB,GACRC,GADQ,CACJ,CADI,EAERC,GAFQ,CAEJ,EAFI,CATiB;AAY5BjB,YAAU,kDAAAe,GACPC,GADO,CACH,CADG,EAEPC,GAFO,CAEH,EAFG,CAZkB;AAe5BzB,YAAU,kDAAAuB,GACPC,GADO,CACH,CADG,EAEPC,GAFO,CAEH,EAFG;AAfkB,CAAf,CAAf,E;;;;;;;;;;;;;;;;;;;ACFA;AACA;AAEO,MAAME,aAAa,gEAAAjH,CAAO,2CAAP,CAAa;;;;;CAAhC;AAOA,MAAMkH,aAAa,wDAAAlH,CAAOqB,GAAI;;CAA9B;AAIA,MAAM8F,qBAAqB,wDAAAnH,CAAOqB,GAAI;gBAC7B,CAAC;AAAEnB;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAY6D,IAAK;aACnC,CAAC;AAAE9D;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAY6D,IAAK;;;;;;;;CAFtC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;ACdP;AACA;AACA;AACA;AACA;AAEA;AAUA;AACA;AACA;AAKA,IAAIqB,gBAAgB;AAClBM,YAAU,EADQ;AAElBL,YAAU,EAFQ;AAGlBf,sBAAoB;AAHF,CAApB;;AAMA,IAAI,KAAJ,EAA+C,EAO9C;;AAED,SAASN,QAAT,CACElD,KADF,EAEEmD,MAFF,EAGEkD,SAHF,EAIE;AACAA,YAAU9C,aAAV,CAAwB,IAAxB;AACA,SAAOJ,OAAOK,kBAAd;AACAC,EAAA,4CAAAA,CACGC,IADH,CACQ,YADR,EACsBP,MADtB,EAEGT,IAFH,CAEQiB,OAAO;AACX0C,cAAU9C,aAAV,CAAwB,KAAxB;AACAvD,UAAMsG,eAAN,CAAsB3C,IAAIC,IAA1B;AACA5D,UAAM6D,OAAN,CAAc0C,OAAd,CAAsB,GAAtB;AACD,GANH,EAOGxC,KAPH,CAOUC,GAAD,IAAqB;AAC1BqC,cAAU9C,aAAV,CAAwB,KAAxB;AACA8C,cAAUpC,SAAV,CAAoB;AAAET,0BAAoBQ,IAAKE,QAAL,CAAeN;AAArC,KAApB;AACD,GAVH;AAWD;;AAED,MAAMlD,QAA0BV,SAC9B,2DAAC,6CAAD;AACE,iBAAesE,aADjB;AAEE,oBAAkB,yDAFpB;AAGE,YAAUpB,SAASsB,IAAT,CAAc,IAAd,EAAoBxE,KAApB,CAHZ;AAIE,UAAQ,CAAC;AAAE0E,WAAF;AAAWD,UAAX;AAAmBE;AAAnB,GAAD,KAAuC;AAC7C,WAAO3E,MAAMQ,YAAN,GACL,2DAAC,yDAAD;AAAU,UAAG;AAAb,MADK,GAGL,wHACE,2DAAC,uDAAD,gBADF,EAEGiE,OAAOjB,kBAAP,IACC,2DAAC,oEAAD,0BACiBiB,OAAOjB,kBADxB,CAHJ,EAOE,2DAAC,sDAAD,QACE,2DAAC,sDAAD,QACE,2DAAC,uDAAD;AAAO,eAAQ;AAAf,oBACW,6EADX,CADF,EAIE,sEAJF,EAKE,2DAAC,6DAAD;AAAa,YAAK,MAAlB;AAAyB,YAAK,UAA9B;AAAyC,UAAG;AAA5C,MALF,EAME,2DAAC,8DAAD,QACGkB,QAAQE,QAAR,IAAoBH,OAAOG,QAA3B,IAAuCH,OAAOG,QADjD,CANF,CADF,EAWE,2DAAC,sDAAD,QACE,2DAAC,uDAAD;AAAO,eAAQ;AAAf,oBACW,6EADX,CADF,EAIE,sEAJF,EAKE,2DAAC,6DAAD;AAAa,YAAK,UAAlB;AAA6B,YAAK,UAAlC;AAA6C,UAAG;AAAhD,MALF,EAME,2DAAC,8DAAD,QACGF,QAAQH,QAAR,IAAoBE,OAAOF,QAA3B,IAAuCE,OAAOF,QADjD,CANF,CAXF,EAqBE,2DAAC,8DAAD,iBArBF,EAsBE,2DAAC,4DAAD;AAAY,UAAG;AAAf,6DAtBF,EAyBE,2DAAC,8DAAD,4CACkC,gFADlC,2BAEK,kFAFL,CAzBF,CAPF,CAHF;AA0CD;AA/CH,EADF;;AAoDA,SAASxD,eAAT,CAAyBC,KAAzB,EAA8C;AAC5C,SAAO;AACLR,kBAAcQ,MAAMR;AADf,GAAP;AAGD;;AAED,+DAAe,2DAAAY,CAAQL,eAAR,EAAyB,4CAAzB,EAAyCL,KAAzC,CAAf,E;;;;;;;;;;;;;;;ACpHA;AAEA,+DAAe,kDAAAkF,GAASC,KAAT,CAAe;AAC5BjB,YAAU,kDAAAkB,GACPC,GADO,CACH,CADG,EAEPC,GAFO,CAEH,EAFG,EAGPC,QAHO,EADkB;AAK5B1B,YAAU,kDAAAuB,GACPC,GADO,CACH,CADG,EAEPC,GAFO,CAEH,EAFG,EAGPC,QAHO;AALkB,CAAf,CAAf,E;;;;;;;;;;;;;;;;;;;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AAEA;;AAKA,MAAMtF,MAAN,SAAqB,+CAArB,CAA2D;AAAA;AAAA;;AAAA,kEACnC;AAAE6F,iBAAW;AAAb,KADmC;AAAA;;AAGzDC,sBAAoB;AAClBhD,IAAA,4CAAAA,CACGC,IADH,CACQ,aADR,EAEGhB,IAFH,CAEQ,MAAM;AACV,WAAK1C,KAAL,CAAW0G,kBAAX;AACA,WAAKC,QAAL,CAAc;AAAEH,mBAAW;AAAb,OAAd;AACD,KALH,EAMGzC,KANH,CAMSC,OAAO;AACZ4C,cAAQ9E,KAAR,CAAckC,GAAd;AACD,KARH;AASD;;AAED6C,WAAS;AACP,WAAO,KAAK7F,KAAL,CAAWwF,SAAX,GAAuB,2DAAC,yDAAD;AAAU,UAAG;AAAb,MAAvB,GAAkD,gBAAzD;AACD;;AAjBwD;;AAoB3D,SAASzF,eAAT,CAAyBC,KAAzB,EAA8C;AAC5C,SAAO;AACLR,kBAAcQ,MAAMR;AADf,GAAP;AAGD;;AAED,SAASsG,kBAAT,CAA4BC,QAA5B,EAA2E;AACzE,SAAO,gEAAAC,CAAmB;AAAEN,IAAA,sFAAAA;AAAF,GAAnB,EAA2CK,QAA3C,CAAP;AACD;;AAED,+DAAe,2DAAA3F,CAAQL,eAAR,EAAyB+F,kBAAzB,EAA6CnG,MAA7C,CAAf,E;;;;;;;;;;;;;;;;;;;;;;;;;;ACzCA;AACA;AAGA;AACA;AACA;AAEA;AAYA;AACA;AAKA,MAAM2D,gBAAgB;AACpBM,YAAU,EADU;AAEpBC,SAAO,EAFa;AAGpBC,aAAW,EAHS;AAIpBC,YAAU,EAJU;AAKpBR,YAAU,EALU;AAMpBf,sBAAoB;AANA,CAAtB;;AASA,SAASN,QAAT,CACElD,KADF,EAEEmD,MAFF,EAGEkD,SAHF,EAIE;AACAA,YAAU9C,aAAV,CAAwB,IAAxB;AACAE,EAAA,4CAAAA,CACGC,IADH,CACQ,mBADR,EAC6BP,MAD7B,EAEGT,IAFH,CAEQiB,OAAO;AACX0C,cAAU9C,aAAV,CAAwB,KAAxB;AACAvD,UAAMsG,eAAN,CAAsB3C,IAAIC,IAA1B;AACA5D,UAAM6D,OAAN,CAAc0C,OAAd,CAAsB,GAAtB;AACD,GANH,EAOGxC,KAPH,CAOSC,OAAO;AACZqC,cAAU9C,aAAV,CAAwB,KAAxB;AACA8C,cAAUpC,SAAV,CAAoB;AAAET,0BAAoBQ,IAAIE,QAAJ,CAAaN;AAAnC,KAApB;AACD,GAVH;AAWD;;AAED,MAAMnD,eAAwCT,SAAS;AACrD,SACE,2DAAC,6CAAD;AACE,mBAAesE,aADjB;AAEE,sBAAkB,yDAFpB;AAGE,cAAUpB,SAASsB,IAAT,CAAc,IAAd,EAAoBxE,KAApB,CAHZ;AAIE,YAAQ,CAAC;AAAE0E,aAAF;AAAWD,YAAX;AAAmBE;AAAnB,KAAD,KAAuC;AAC7C,aAAO3E,MAAMQ,YAAN,GACL,2DAAC,yDAAD;AAAU,YAAG;AAAb,QADK,GAGL,wHACE,2DAAC,uDAAD,yBADF,EAEGiE,OAAOjB,kBAAP,IACC,2DAAC,oEAAD,0BACiBiB,OAAOjB,kBADxB,CAHJ,EAOE,2DAAC,4DAAD,QACE,2DAAC,4DAAD,QACE,2DAAC,uDAAD;AAAO,iBAAQ;AAAf,sBACW,6EADX,CADF,EAIE,sEAJF,EAKE,2DAAC,6DAAD;AAAa,cAAK,MAAlB;AAAyB,cAAK,UAA9B;AAAyC,YAAG;AAA5C,QALF,EAME,2DAAC,8DAAD,QACGkB,QAAQE,QAAR,IAAoBH,OAAOG,QAA3B,IAAuCH,OAAOG,QADjD,CANF,CADF,EAWE,2DAAC,4DAAD,QACE,2DAAC,uDAAD;AAAO,iBAAQ;AAAf,mBACQ,6EADR,CADF,EAIE,sEAJF,EAKE,2DAAC,6DAAD;AAAa,cAAK,OAAlB;AAA0B,cAAK,OAA/B;AAAuC,YAAG;AAA1C,QALF,EAME,2DAAC,8DAAD,QACGF,QAAQG,KAAR,IAAiBJ,OAAOI,KAAxB,IAAiCJ,OAAOI,KAD3C,CANF,CAXF,EAqBE,2DAAC,4DAAD,QACE,2DAAC,uDAAD;AAAO,iBAAQ;AAAf,sBADF,EAEE,sEAFF,EAGE,2DAAC,6DAAD;AAAa,cAAK,MAAlB;AAAyB,cAAK,WAA9B;AAA0C,YAAG;AAA7C,QAHF,EAIE,2DAAC,8DAAD,QACGH,QAAQI,SAAR,IAAqBL,OAAOK,SAA5B,IAAyCL,OAAOK,SADnD,CAJF,CArBF,EA6BE,2DAAC,4DAAD,QACE,2DAAC,uDAAD;AAAO,iBAAQ;AAAf,qBADF,EAEE,sEAFF,EAGE,2DAAC,6DAAD;AAAa,cAAK,MAAlB;AAAyB,cAAK,UAA9B;AAAyC,YAAG;AAA5C,QAHF,EAIE,2DAAC,8DAAD,QACGJ,QAAQK,QAAR,IAAoBN,OAAOM,QAA3B,IAAuCN,OAAOM,QADjD,CAJF,CA7BF,EAqCE,2DAAC,8DAAD,QACE,2DAAC,4DAAD,QACE,2DAAC,uDAAD;AAAO,iBAAQ;AAAf,sBACW,6EADX,CADF,EAIE,sEAJF,EAKE,2DAAC,6DAAD;AAAa,cAAK,UAAlB;AAA6B,cAAK,UAAlC;AAA6C,YAAG;AAAhD,QALF,EAME,2DAAC,8DAAD,QACGL,QAAQH,QAAR,IAAoBE,OAAOF,QAA3B,IAAuCE,OAAOF,QADjD,CANF,CADF,CArCF,EAiDE,2DAAC,8DAAD,QACE,2DAAC,8DAAD;AAAc,cAAK,QAAnB;AAA4B,kBAAUI;AAAtC,kBADF,CAjDF,EAsDE,2DAAC,8DAAD,QACE,2DAAC,4DAAD;AAAY,YAAG;AAAf,mDADF,CAtDF,CAPF,CAHF;AAwED;AA7EH,IADF;AAiFD,CAlFD;;AAoFA,SAAS5D,eAAT,CAAyBC,KAAzB,EAA8C;AAC5C,SAAO;AACLR,kBAAcQ,MAAMR;AADf,GAAP;AAGD;;AAED,+DAAe,2DAAAY,CAAQL,eAAR,EAAyB;AAAEuF,EAAA,gFAAAA;AAAF,CAAzB,EAA8C7F,YAA9C,CAAf,E;;;;;;;;;;;;;;;AChJA;AAEA,+DAAe,kDAAAmF,GAASC,KAAT,CAAe;AAC5BjB,YAAU,kDAAAkB,GACPC,GADO,CACH,CADG,EAEPC,GAFO,CAEH,EAFG,EAGPC,QAHO,EADkB;AAK5BpB,SAAO,kDAAAiB,GACJjB,KADI,GAEJmB,GAFI,CAEA,EAFA,EAGJC,QAHI,EALqB;AAS5BnB,aAAW,kDAAAgB,GACRC,GADQ,CACJ,CADI,EAERC,GAFQ,CAEJ,EAFI,CATiB;AAY5BjB,YAAU,kDAAAe,GACPC,GADO,CACH,CADG,EAEPC,GAFO,CAEH,EAFG,CAZkB;AAe5BzB,YAAU,kDAAAuB,GACPC,GADO,CACH,CADG,EAEPC,GAFO,CAEH,EAFG,EAGPC,QAHO;AAfkB,CAAf,CAAf,E;;;;;;;;;;;;;;;;;;ACFA;AASO,MAAMgB,2BAAmE3F,MAAM;AACpF,SAAO;AACLC,UAAM,2DAAA2F,CAAqBC,2BADtB;AAEL7F;AAFK,GAAP;AAID,CALM;AAOA,MAAM8F,2BAAmEzF,QAAQ;AACtF,SAAO;AACLJ,UAAM,2DAAA2F,CAAqBG,2BADtB;AAEL1F;AAFK,GAAP;AAID,CALM;AAOA,MAAM2F,wBAA6DxF,SAAS;AACjF,SAAO;AACLP,UAAM,2DAAA2F,CAAqBK,wBADtB;AAELzF;AAFK,GAAP;AAID,CALM;AAOA,MAAM0F,aAAuClG,MAAM;AACxD,SAAO;AACLC,UAAM,sDAAAkG,CAAgBC,WADjB;AAELpG;AAFK,GAAP;AAID,CALM,C;;;;;;;;;;;;;;;;;AC9BP;AAKO,MAAMqG,kBAAmBrG,EAAD,IAAgB;AAC7C,MAAI,KAAJ,EAAgB,EAAhB,MAIO,IAAI,IAAJ,EAAgB;AACrB,UAAMc,OAAO,mBAAAC,CAAQ,yEAAR,EACVC,OADH;;AAGA,WAAOF,KAAKG,QAAL,CAAcjB,EAAd,EAAkBc,KAAKI,YAAvB,EACJC,IADI,GAEJC,IAFI,CAEEf,IAAD,IAAiB;AACrBA,WAAKgB,GAAL,GAAWhB,KAAKgB,GAAL,CAASC,QAAT,EAAX;AACA,aAAOjB,IAAP;AACD,KALI,CAAP;AAMD;AACF,CAhBM;AAkBA,MAAM6F,aAAclG,EAAD,IAAgB;AACxC,SAAO,4CAAAmC,CAAMmE,MAAN,CAAc,eAActG,EAAG,EAA/B,CAAP;AACD,CAFM,C;;;;;;;;;;;;;;;;ACvBP;AACA;;AAIA,MAAMuG,YAAkC,CAAC;AACvC1I,OADuC;AAEvC2I,UAAQ,EAF+B;AAGvCC,WAAS;AAH8B,CAAD,KAIlC;AACJ,SACE;AAAK,WAAOD,KAAZ;AAAmB,YAAQC,MAA3B;AAAmC,WAAM;AAAzC,KACE;AACE,OAAE,qEADJ;AAEE,UAAM5I,MAAMI,MAAN,CAAayI,QAFrB;AAGE,cAAS;AAHX,IADF,CADF;AASD,CAdD;;AAgBA,+DAAe,kEAAAC,CAAUJ,SAAV,CAAf,E;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrBA;AACA;AACA;AAEO,MAAMK,OAAO,wDAAAjJ,CAAOkJ,OAAQ;;;;;;mBAMhB,CAAC;AAAEhJ;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYS,KAAM;aACvC,CAAC;AAAEV;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYS,KAAM;2BACnB,CAAC;AAAEV;AAAF,CAAD,KAAe,qDAAAG,CAAKH,MAAMI,MAAN,CAAaC,UAAlB,EAA8B,IAA9B,CAAoC;CARvE;AAWA,MAAM4I,WAAW,wDAAAnJ,CAAOoJ,EAAG;;eAEnB,CAAC;AAAElJ;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYC,MAAO;;;CAF1C;AAOA,MAAMiJ,WAAW,wDAAArJ,CAAOsJ,EAAG;;;;CAA3B;AAMA,MAAMC,QAAQ,wDAAAvJ,CAAOwJ,CAAE;YAClB,CAAC;AAAEtJ;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYC,MAAO;;;;;CADvC;AAQA,MAAMqJ,kBAAkB,wDAAAzJ,CAAOwJ,CAAE;YAC5B,CAAC;AAAEtJ;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYS,KAAM;;;;;CADtC;AAQA,MAAM8I,UAAU,wDAAA1J,CAAOS,OAAQ;;;;;gBAKtB,CAAC;AAAEP;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYwJ,KAAM;CAL1C;AAQA,MAAM9F,aAAa,gEAAA7D,CAAO,qDAAP,CAAa;;;;gBAIvB,CAAC;AAAEE;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYyJ,KAAM;YACrC,CAAC;AAAE1J;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYC,MAAO;;mBAE3B,CAAC;AAAEF;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYC,MAAO;;eAEtC,CAAC;AAAEF;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAY6D,IAAK;;;mBAG5B,CAAC;AAAE9D;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYC,MAAO;;;CAZ9C;AAiBA,MAAMyJ,aAAahG,WAAWC,MAAO;sBACtB,CAAC;AAAE5D;AAAF,CAAD,KAAeA,MAAMI,MAAN,CAAayI,QAAS;CADpD;AAIA,MAAMe,eAAejG,WAAWkG,aAAX,CAAyB,QAAzB,EAAmCjG,MAAO;sBAChD,CAAC;AAAE5D;AAAF,CAAD,KAAeA,MAAMI,MAAN,CAAayD,SAAU;;CADrD;AAKA,MAAMiG,aAAa,gEAAAhK,CAAO,qDAAP,CAAa;;;;mBAIpB,CAAC;AAAEE;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYS,KAAM;WACzC,CAAC;AAAEV;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAY8J,MAAO;YACjC,CAAC;AAAE/J;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYC,MAAO;sBACxB,CAAC;AAAEF;AAAF,CAAD,KAAeA,MAAMI,MAAN,CAAayI,QAAS;mBACxC,CAAC;AAAE7I;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYC,MAAO;;WAE1C,CAAC;AAAEF;AAAF,CAAD,KAAeA,MAAMI,MAAN,CAAayI,QAAS;;;;;;;CAVzC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9EP;AACA;AACA;AAEA;AAWA;AACA;AACA;;AAKA,MAAMnH,UAAN,SAAyB,+CAAzB,CAAqD;AACnDsI,cAAYnJ,KAAZ,EAAqC;AACnC,UAAMA,KAAN;;AADmC,wCAMxB,MAAM;AACjB,YAAM;AACJ6D,eADI;AAEJR,eAAO;AACLC,kBAAQ;AAAEhC;AAAF;AADH,SAFH;AAKJkG,kBALI;AAMJd;AANI,UAOF,KAAK1G,KAPT;AAQAwH,iBAAWlG,EAAX;AACAoF;AACA7C,cAAQC,IAAR,CAAa,QAAb;AACD,KAlBoC;;AAGnC,QAAI,IAAJ,EAAgB9D,MAAMiH,wBAAN,CAA+B,KAAKjH,KAAL,CAAWqD,KAAX,CAAiBC,MAAjB,CAAwBhC,EAAvD;AACjB;;AAgBDuF,WAAS;AACP,UAAM;AACJzC,WADI;AAEJf,aAAO;AACLC,gBAAQ;AAAEhC,cAAI6C;AAAN;AADH;AAFH,QAKF,KAAKnE,KALT;;AAOA,QAAI,CAAC,oBAAoBoJ,IAApB,CAAyBjF,UAAzB,CAAD,IAAyC,CAACC,MAAMC,MAApD,EAA4D;AAC1D,aAAO,2DAAC,yDAAD;AAAU,YAAG;AAAb,QAAP;AACD;;AAED,UAAM;AAAES,eAAF;AAAaC,cAAb;AAAuBH,cAAvB;AAAiCC,WAAjC;AAAwCwE;AAAxC,QAAsDjF,MAAMkF,IAAN,CAC1D3H,QAAQA,KAAKgB,GAAL,KAAawB,UADqC,CAA5D;AAGA,UAAM;AAAExB,WAAK4G;AAAP,QAA0B,KAAKvJ,KAAL,CAAWQ,YAA3C;AAEA,WACE,wHACE,2DAAC,6DAAD;AAAY,UAAG;AAAf,OACE,2DAAC,6DAAD,OADF,EAEE,6EAFF,CADF,EAKE,2DAAC,uDAAD,QACGsE,aAAaC,QAAb,GACC,wHACE,2DAAC,2DAAD,QACGD,SADH,OACeC,QADf,CADF,EAIE,2DAAC,2DAAD,aAAYH,QAAZ,CAJF,CADD,GAQC,2DAAC,2DAAD,aAAYA,QAAZ,CATJ,EAWE,2DAAC,wDAAD,QACE,kFADF,OACuBC,KADvB,CAXF,EAcE,2DAAC,kEAAD,QACE,8FADF,EAEG,IAAI2E,IAAJ,CAASH,SAAT,EAAoBI,YAApB,EAFH,CAdF,EAkBGF,mBAAmBpF,UAAnB,IACC,2DAAC,0DAAD,QACE,2DAAC,6DAAD;AAAY,UAAK,IAAGA,UAAW;AAA/B,sBADF,EAGE,2DAAC,+DAAD;AAAc,UAAG,EAAjB;AAAoB,eAAS,KAAKqD;AAAlC,wBAHF,CAnBJ,CALF,CADF;AAoCD;;AA1EkD;;AA6ErD,+DAAe,2DAAApG,CAAQJ,SAASA,KAAjB,oBACV,4CADU;AAEb0F,EAAA,sFAAAA;AAFa,IAGZ7F,UAHY,CAAf,E;;;;;;;;;;;;;;;;;;;AClGA;AAOe,SAAS6I,iBAAT,CACb1I,KADa,EAEbkE,MAFa,EAGb;AACA,UAAQA,OAAO3D,IAAf;AACE,SAAK,2DAAA2F,CAAqBC,2BAA1B;AACE,+BAAYnG,KAAZ;AAAmBmE,2BAAmB;AAAtC;;AACF,SAAK,2DAAA+B,CAAqBG,2BAA1B;AACE,+BACKrG,KADL;AAEEoD,eAAO,CAAC,GAAGpD,MAAMoD,KAAV,oBAAsBc,OAAOvD,IAA7B,EAFT;AAGEwD,2BAAmB;AAHrB;;AAKF,SAAK,2DAAA+B,CAAqBK,wBAA1B;AACE,+BAAYvG,KAAZ;AAAmBc,eAAOoD,OAAOpD,KAAjC;AAAwCqD,2BAAmB;AAA3D;;AAEF,SAAK,sDAAAsC,CAAgBC,WAArB;AACE,YAAM;AAAEtD;AAAF,UAAYpD,KAAlB;AACA,YAAMoE,MAAMhB,MAAMiB,SAAN,CAAgB1D,QAAQA,KAAKgB,GAAL,KAAauC,OAAO5D,EAA5C,CAAZ;AACA,+BACKN,KADL;AAEEoD,eAAO,CAAC,GAAGA,MAAMkB,KAAN,CAAY,CAAZ,EAAeF,GAAf,CAAJ,EAAyB,GAAGhB,MAAMkB,KAAN,CAAYF,MAAM,CAAlB,CAA5B;AAFT;;AAKF;AACE,aAAOpE,KAAP;AArBJ;AAuBD,C;;;;;;;;;;;;;;;;;;;;;ACnCD;AAEA;AACA;AAKA;AAOO,UAAU2I,qBAAV,CAAgCzE,MAAhC,EAAiE;AACtE,MAAIA,OAAO3D,IAAP,KAAgB,2DAAA2F,CAAqBC,2BAAzC,EAAsE;AACpE,QAAI;AACF,YAAMxF,OAAO,MAAM,+DAAA6D,CAAK,2DAAL,EAAsBN,OAAO5D,EAA7B,CAAnB;AACA,YAAM,8DAAAmE,CAAI,gFAAA2B,CAAyBzF,IAAzB,CAAJ,CAAN;AACD,KAHD,CAGE,OAAOG,KAAP,EAAc;AACd,YAAM,8DAAA2D,CAAI,6EAAA6B,CAAsBxF,KAAtB,CAAJ,CAAN;AACD;AACF;AACF;AAEM,UAAU8H,gBAAV,CAA2B1E,MAA3B,EAAsD;AAC3D,MAAI;AACF,UAAM,+DAAAM,CAAK,sDAAL,EAAiBN,OAAO5D,EAAxB,CAAN;AACD,GAFD,CAEE,OAAOuI,CAAP,EAAU;AACVjD,YAAQ9E,KAAR,CAAc+H,CAAd;AACD;AACF;AAEc,UAAUC,oBAAV,GAAiC;AAC9C,QAAM,8DAAAC,CAAI,CACR,qEAAApE,CACE,2DAAAuB,CAAqBC,2BADvB,EAEEwC,qBAFF,CADQ,EAKR,qEAAAhE,CAAW,sDAAA8B,CAAgBC,WAA3B,EAAwCkC,gBAAxC,CALQ,CAAJ,CAAN;AAOD,C;;;;;;;;;;;;;;;ACvBD,IAAY1C,oBAAZ;;WAAYA,oB;AAAAA,sB;AAAAA,sB;AAAAA,sB;GAAAA,oB,KAAAA,oB;;AAiCZ;;;AAIA,IAAYO,eAAZ;;WAAYA,e;AAAAA,iB;GAAAA,e,KAAAA,e;;;;;;;;;;;;;;;;;ACxDZ;AAOO,MAAMuC,sBAAyD,MAAM;AAC1E,SAAO;AACLzI,UAAM,4DAAA0I,CAAsBC;AADvB,GAAP;AAGD,CAJM;AAKA,MAAMC,sBAAyD/F,SAAS;AAC7E,SAAO;AACL7C,UAAM,4DAAA0I,CAAsBG,qBADvB;AAELhG;AAFK,GAAP;AAID,CALM;AAMA,MAAMiG,mBAAmDvI,SAAS;AACvE,SAAO;AACLP,UAAM,4DAAA0I,CAAsBK,kBADvB;AAELxI;AAFK,GAAP;AAID,CALM,C;;;;;;;;;;;;;;;;AClBP;AASO,MAAMyI,aAAa,MAAM;AAC9B,MAAI,KAAJ,EAAgB,EAAhB,MAEO,IAAI,IAAJ,EAAgB;AACrB,UAAMnI,OAAO,mBAAAC,CAAQ,yEAAR,EACVC,OADH;;AAGA,WAAOF,KAAKkH,IAAL,CAAU,EAAV,EAAclH,KAAKI,YAAnB,EACJC,IADI,GAEJC,IAFI,CAEE0B,KAAD,IAAoB;AACxB,aAAOA,MAAMoG,GAAN,CAAU7I,QAAQ;AACvBA,aAAKgB,GAAL,GAAWhB,KAAKgB,GAAL,CAASC,QAAT,EAAX;AACA,eAAOjB,IAAP;AACD,OAHM,CAAP;AAID,KAPI,CAAP;AAQD;AACF,CAhBM,C;;;;;;;;;;;;;;;;ACTP;AACA;AAIA,MAAM8I,YAAY,wDAAAxL,CAAOwJ,CAAE;;;eAGZ,CAAC;AAAEtJ;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAY6D,IAAK;;;WAGpC,CAAC;AAAE9D;AAAF,CAAD,KAAeA,MAAMI,MAAN,CAAaC,UAAW;CANlD;;AASA,MAAMkL,iBAA4C,CAAC;AACjDnB,gBADiD;AAEjDoB;AAFiD,CAAD,KAG5C;AACJ,SAAOpB,mBAAmBoB,MAAnB,GACL,2DAAC,SAAD,mCADK,GAEH,IAFJ;AAGD,CAPD;;AASA,+DAAeD,cAAf,E;;;;;;;;;;;;;;;;;;;;;ACvBA;AACA;AACA;AAIO,MAAMxC,OAAO,gEAAAjJ,CAAO,qDAAP,CAAa;;;;;YAKrB,CAAC;AAAEE;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYwJ,KAAM;eAC9B,CAAC;AAAEzJ;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYS,KAAM;;kBAE9B,CAAC;AAAEV;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYS,KAAM;;2BAExB,CAAC;AAAEV;AAAF,CAAD,KAAe,qDAAAG,CAAKH,MAAMI,MAAN,CAAaC,UAAlB,EAA8B,IAA9B,CAAoC;;;;wBAItD,CAAC;AAAEL;AAAF,CAAD,KAAeA,MAAMI,MAAN,CAAaqL,OAAQ;;;mBAGzC,CAAC;AAAEzL;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYyL,MAAO;CAjB9C;AAoBA,MAAMzC,WAAW,gEAAAnJ,CAA6B,IAA7B,CAAmC;;;eAG5C,CAAC;AAAEE;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAY6D,IAAK;iBAC9B,CAAC;AAAE6H;AAAF,CAAD,KAAeA,OAAO,MAAP,GAAgB,QAAU;;CAJnD;AAQA,MAAMxC,WAAW,wDAAArJ,CAAOsJ,EAAG;;;eAGnB,CAAC;AAAEpJ;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAY6D,IAAK;;;CAHxC,C;;;;;;;;;;;;;;;;;;;;;;AClCP;AACA;AACA;AAEA;AACA;AACA;;AAIA,MAAMrC,QAAN,SAAuB,+CAAvB,CAAiD;AAC/CuI,cAAYnJ,KAAZ,EAAmC;AACjC,UAAMA,KAAN;AACA,QAAI,KAAKA,KAAL,CAAWQ,YAAf,EAA6B,KAAKR,KAAL,CAAWgK,mBAAX;AAC9B;;AAEDnD,WAAS;AACP,QAAI,KAAK7G,KAAL,CAAWQ,YAAf,EAA6B;AAC3B,YAAM;AAAEA,oBAAF;AAAgB4D;AAAhB,UAA0B,KAAKpE,KAArC;AACA,YAAMuJ,iBAAiB/I,aAAamC,GAApC;AAEA,aAAOyB,MAAMoG,GAAN,CAAU7I,QAAQ;AACvB,cAAM;AAAEmD,mBAAF;AAAaC,kBAAb;AAAuBH;AAAvB,YAAoCjD,IAA1C;AACA,YAAIgJ,SAAShJ,KAAKgB,GAAlB;AACA,eACE,2DAAC,uDAAD;AAAM,eAAKgI,MAAX;AAAmB,cAAK,IAAGA,MAAO;AAAlC,WACG7F,aAAaC,QAAb,GACC,wHACE,2DAAC,2DAAD;AAAU,gBAAMwE,mBAAmBoB;AAAnC,WACG7F,SADH,OACeC,QADf,EAEE,2DAAC,kEAAD;AACE,0BAAgBwE,cADlB;AAEE,kBAAQoB;AAFV,UAFF,CADF,EAQE,2DAAC,2DAAD,aAAY/F,QAAZ,CARF,CADD,GAYC,2DAAC,2DAAD;AAAU,gBAAM2E,mBAAmBoB;AAAnC,gBACI/F,QADJ,EAEE,2DAAC,kEAAD;AACE,0BAAgB2E,cADlB;AAEE,kBAAQoB;AAFV,UAFF,CAbJ,CADF;AAwBD,OA3BM,CAAP;AA4BD,KAhCD,MAgCO;AACL,aAAO,2DAAC,yDAAD;AAAU,YAAG;AAAb,QAAP;AACD;AACF;;AA1C8C;;AA6CjD,+DAAe,2DAAAvJ,CAAQJ,SAASA,KAAjB,EAAwB,4CAAxB,EAAwCJ,QAAxC,CAAf,E;;;;;;;;;;;;;;;;;;;ACvDA;AAGe,SAASmK,QAAT,CACb/J,KADa,EAEbkE,MAFa,EAGb;AACA,UAAQA,OAAO3D,IAAf;AACE,SAAK,4DAAA0I,CAAsBC,qBAA3B;AACE,+BAAYlJ,KAAZ;AAAmBmE,2BAAmB;AAAtC;;AACF,SAAK,4DAAA8E,CAAsBG,qBAA3B;AACE,+BAAYpJ,KAAZ;AAAmBoD,eAAOc,OAAOd,KAAjC;AAAwCe,2BAAmB;AAA3D;;AACF,SAAK,4DAAA8E,CAAsBK,kBAA3B;AACE,+BAAYtJ,KAAZ;AAAmBc,eAAOoD,OAAOpD,KAAjC;AAAwCqD,2BAAmB;AAA3D;;AACF;AACE,aAAOnE,KAAP;AARJ;AAUD,C;;;;;;;;;;;;;;;;;;;ACjBD;AACA;AACA;AAEO,UAAUuJ,UAAV,GAAuB;AAC5B,MAAI;AACF,UAAMnG,QAAQ,MAAM,+DAAAoB,CAAK,sDAAL,CAApB;AACA,UAAM,8DAAAC,CAAI;AAAElE,YAAM,4DAAA0I,CAAsBG,qBAA9B;AAAqDhG;AAArD,KAAJ,CAAN;AACD,GAHD,CAGE,OAAOtC,KAAP,EAAc;AACd,UAAM,8DAAA2D,CAAI;AAAElE,YAAM,4DAAA0I,CAAsBK,kBAA9B;AAAkDxI;AAAlD,KAAJ,CAAN;AACD;AACF;AAEc,UAAUkJ,YAAV,GAAyB;AACtC,QAAM,qEAAArF,CAAW,4DAAAsE,CAAsBC,qBAAjC,EAAwDK,UAAxD,CAAN;AACD,C;;;;;;;;;;;;;;ACLD,IAAYN,qBAAZ;;WAAYA,qB;AAAAA,uB;AAAAA,uB;AAAAA,uB;GAAAA,qB,KAAAA,qB;;;;;;;;;;;;;;;;ACVZ;AAMO,MAAM3D,kBAAiD3E,QAAQ;AACpE,SAAO;AACLJ,UAAM,wDAAA0J,CAAkBC,kBADnB;AAELvJ;AAFK,GAAP;AAID,CALM;AAOA,MAAM+E,qBAAuD,MAAM;AACxE,SAAO;AACLnF,UAAM,wDAAA0J,CAAkBE;AADnB,GAAP;AAGD,CAJM,C;;;;;;;;;;;;;;;;;;;;ACbP;AACA;AAEA;AAIO,MAAMC,eAA6B;AACxChH,SAAO,EADiC;AAExC5D,gBAAc,IAF0B;AAGxC2E,qBAAmB,KAHqB;AAIxCrD,SAAO;AAJiC,CAAnC;AAOQ,SAASuJ,cAAT,CAAwBC,iBAAiBF,YAAzC,EAAuD;AACpE,QAAMG,YAA2C,EAAjD;AAEA,QAAMC,iBAAiB,iDAAAC,EAAvB;AACAF,YAAUzH,IAAV,CAAe,6DAAA4H,CAAgBF,cAAhB,CAAf;;AAEA,MACE,kBAAyB,aAAzB,IACA,OAAOG,MAAP,KAAkB,QADlB,IAEA,OAAOA,OAAOC,4BAAd,KAA+C,UAHjD,EAIE;AACAL,cAAUzH,IAAV,CAAe6H,OAAOC,4BAAP,EAAf;AACD;;AAED,QAAMC,QAAQ,yDAAAC,CACZ,oDADY,EAEZR,cAFY,EAGZ,qDAAAS,CAAQ,GAAGR,SAAX,CAHY,CAAd;AAMAM,QAAMG,OAAN,GAAgBR,eAAeS,GAA/B;;AACAJ,QAAMK,KAAN,GAAc,MAAML,MAAM9E,QAAN,CAAe,8CAAf,CAApB;;AAEA,SAAO8E,KAAP;AACD,C;;;;;;;;;;;;;;ACtCD;AAEA,6DAAa;;;;;;;;;;;;;;;;CAAb,C;;;;;;;;;;;;;;;;;;;;;;;;;ACFA;AACA;AACA;AAEA;AAIA;AAMA;AAIA;AAWe,SAASM,WAAT,CAAqBnL,KAArB,EAA0CkE,MAA1C,EAA+D;AAC5E,UAAQA,OAAO3D,IAAf;AACE,SAAK,wDAAA0J,CAAkBC,kBAAvB;AACE,+BAAYlK,KAAZ;AAAmBR,sBAAc0E,OAAOvD;AAAxC;;AACF,SAAK,wDAAAsJ,CAAkBE,qBAAvB;AACE,+BAAYnK,KAAZ;AAAmBR,sBAAc;AAAjC;;AAEF,SAAK,kFAAAyJ,CAAsBC,qBAA3B;AACA,SAAK,kFAAAD,CAAsBG,qBAA3B;AACA,SAAK,kFAAAH,CAAsBK,kBAA3B;AACE,aAAO,+EAAA8B,CAAgBpL,KAAhB,EAAuBkE,MAAvB,CAAP;;AAEF,SAAK,mFAAAgC,CAAqBC,2BAA1B;AACA,SAAK,mFAAAD,CAAqBG,2BAA1B;AACA,SAAK,mFAAAH,CAAqBK,wBAA1B;AACE,aAAO,iFAAAmC,CAAkB1I,KAAlB,EAAyBkE,MAAzB,CAAP;;AAEF,SAAK,+EAAAjD,CAAgBC,qBAArB;AACE,aAAO,kFAAAmK,CAAmBrL,KAAnB,EAA0BkE,MAA1B,CAAP;;AAEF;AACE,aAAOlE,KAAP;AApBJ;AAsBD,C;;;;;;;;;;;;;;;;;;;ACpDD;AAEA;AACA;AACA;AAEe,UAAUsL,QAAV,GAAqB;AAClC,QAAM,8DAAAvC,CAAI,CAAC,+DAAAwC,CAAK,oEAAL,CAAD,EAAqB,+DAAAA,CAAK,sEAAL,CAArB,EAA2C,+DAAAA,CAAK,uEAAL,CAA3C,CAAJ,CAAN;AACD,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACRD;AACA;AACA;AAEO,MAAMC,QAAQ,wDAAAvN,CAAOwN,EAAG;eAChB,CAAC;AAAEtN;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYC,MAAO;;;;iBAIhC,CAAC;AAAEF;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAY6D,IAAK;;CAL1C;AASA,MAAMyJ,qBAAqB,wDAAAzN,CAAOwJ,CAAE;WAChC,CAAC;AAAEtJ;AAAF,CAAD,KAAeA,MAAMI,MAAN,CAAayD,SAAU;;CAD1C;AAKA,MAAMF,aAAa,wDAAA7D,CAAO0N,MAAO;;;;eAIzB,CAAC;AAAExN;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAY6D,IAAK;sBACzB,CAAC;AAAE9D;AAAF,CAAD,KAAeA,MAAMI,MAAN,CAAaqL,OAAQ;;;;;;;;CALnD;AAeA,MAAMgC,eAAe9J,WAAWC,MAAO,EAAvC;AAEA,MAAM8J,eAAe,wDAAA5N,CAAOwJ,CAAE;;;;;WAK1B,CAAC;AAAEtJ;AAAF,CAAD,KAAeA,MAAMI,MAAN,CAAayD,SAAU;;CAL1C;AASA,MAAM8J,QAAQ,wDAAA7N,CAAO8N,KAAM;;;;;aAKrB,CAAC;AAAE5N;AAAF,CAAD,KAAeA,MAAMI,MAAN,CAAayD,SAAU;;CAL5C;AAeA,MAAMgK,cAAc,gEAAA/N,CAA0B,4CAA1B,CAAiC;sBACtC,CAAC;AAAEE;AAAF,CAAD,KAAeA,MAAMI,MAAN,CAAaC,UAAW;;;;eAI9C,CAAC;AAAEL;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAY6D,IAAK;;;CALxC;AAUA,MAAMgK,aAAa,gEAAAhO,CAAO,qDAAP,CAAa;gBACvB,CAAC;AAAEE;AAAF,CAAD,KAAeA,MAAMC,KAAN,CAAYS,KAAM;;WAEtC,CAAC;AAAEV;AAAF,CAAD,KAAeA,MAAMI,MAAN,CAAaC,UAAW;;;aAGrC,CAAC;AAAEL;AAAF,CAAD,KAAeA,MAAMI,MAAN,CAAayI,QAAS;;;CAN3C;AAWA,MAAM7B,aAAa,wDAAAlH,CAAOqB,GAAI,EAA9B;AAEA,MAAM4M,eAAe,wDAAAjO,CAAOqB,GAAI;;;;CAAhC;AAMA,MAAM4F,aAAa,gEAAAjH,CAAO,2CAAP,CAAa;;;;;;;CAAhC,C;;;;;;;;;;;;;;;;;;;;ACxFP;AAKA,MAAM;AACJqD,WAASrD,MADL;AAEJkO,KAFI;AAGJC,cAHI;AAIJC,WAJI;AAKJC,eALI;AAMJrF;AANI,IAOF,8CAPJ;AASA;AACA,+DAAehJ,MAAf,E;;;;;;;;;;;;;;;ACfA;AAGA,MAAME,QAAgB;AACpBI,UAAQ;AACNqL,aAAS,SADH;AAEN5H,eAAW,SAFL;AAGNgF,cAAU,SAHJ;AAINxI,gBAAY;AAJN,GADY;AAOpBJ,SAAO;AACLmO,WAAO,6DAAAC,CAAa,CAAb,EAAgB,CAAhB,EAAmB,eAAnB,CADF;AAEL3E,WAAO,6DAAA2E,CAAa,CAAb,EAAgB,CAAhB,EAAmB,eAAnB,CAFF;AAGLtE,YAAQ,6DAAAsE,CAAa,CAAb,EAAgB,CAAhB,EAAmB,eAAnB,CAHH;AAIL5E,WAAO,6DAAA4E,CAAa,CAAb,EAAgB,CAAhB,EAAmB,eAAnB,CAJF;AAKLnO,YAAQ,6DAAAmO,CAAa,CAAb,EAAgB,CAAhB,EAAmB,eAAnB,CALH;AAML3N,WAAO,6DAAA2N,CAAa,CAAb,EAAgB,CAAhB,EAAmB,eAAnB,CANF;AAOLvK,UAAM,6DAAAuK,CAAa,CAAb,EAAgB,CAAhB,EAAmB,eAAnB,CAPD;AAQL3C,YAAQ,6DAAA2C,CAAa,CAAC,CAAd,EAAiB,CAAjB,EAAoB,eAApB,CARH;AASLC,aAAS,6DAAAD,CAAa,CAAC,CAAd,EAAiB,CAAjB,EAAoB,eAApB;AATJ;AAPa,CAAtB;AAoBA,+DAAerO,KAAf,E;;;;;;;;;;;;;ACDA;AAAA;AAEA,IAAY8L,iBAAZ;;WAAYA,iB;AAAAA,mB;AAAAA,mB;GAAAA,iB,KAAAA,iB;;;;;;;;;;;;;;;;ACxBZ;AACA;AAEA,+CAAAyC,CAAIC,MAAJ,CAAW,6CAAAC,CAAOC,GAAP,CAAW,YAAX,CAAX,E;;;;;;;;;;;;;;;;;ACHA;AACA;AACA;AAEA,+DAAgBH,GAAD,IAAsB;AACnCI,EAAA,yDAAAA,CAAkBJ,GAAlB;AACD,CAFD,E;;;;;;;;;;;;;;;;;ACJA;AACA;AAEA,MAAMK,QAAQ,kBAAyB,aAAvC,C,CAEA;;AAEA,+CAAAC,CAAS5M,OAAT,CAAiB,6CAAAwM,CAAOC,GAAP,CAAW,OAAX,CAAjB;AAEA,+CAAAG,CAASC,UAAT,CAAoBC,EAApB,CAAuB,OAAvB,EAAgClK,OAAO;AACrC4C,UAAQ9E,KAAR,CAAc,oBAAd,EAAoCkC,GAApC;AACD,CAFD,E;;;;;;;;;;;;;;;;;;;;;;ACTA;AACA;AAMA;AACA;AAEA;AAEA,+DAAgB0J,GAAD,IAAsB;AACnCA,MAAIS,GAAJ,CAAQ,+CAAAC,CAASC,UAAT,EAAR;AAEA,QAAMC,UAA2B;AAC/BC,mBAAeC,GAAf,EAAoB;AAClB,UAAIC,QAAQ,IAAZ;;AACA,UAAID,OAAOA,IAAIE,aAAf,EAA8B;AAC5BD,gBAAQD,IAAIE,aAAJ,CAAkB,cAAlB,CAAR;AACD;;AACD,aAAOD,KAAP;AACD,KAP8B;;AAQ/BE,iBAAa,6CAAAf,CAAOC,GAAP,CAAW,YAAX;AARkB,GAAjC;AAWAO,EAAA,+CAAAA,CAASD,GAAT,CACE,IAAI,qDAAJ,CAAgBG,OAAhB,EAAyB,CAACM,OAAD,EAAUC,IAAV,KAAmB;AAC1CzM,IAAA,oDAAAA,CAAKG,QAAL,CAAcqM,QAAQtN,EAAtB,EAA0B,CAAC0C,GAAD,EAAMrC,IAAN,KAAe;AACvC,UAAIqC,GAAJ,EAAS,OAAO6K,KAAK7K,GAAL,CAAP;AACT,UAAI,CAACrC,IAAL,EAAW,OAAOkN,KAAK,IAAL,EAAW,KAAX,CAAP;AACX,aAAOA,KAAK,IAAL,EAAW,kDAAAC,CAAKnN,IAAL,EAAW,oDAAAS,CAAKI,YAAhB,CAAX,CAAP;AACD,KAJD;AAKD,GAND,CADF;AASD,CAvBD,E;;;;;;;;;;;;;;;;;;;ACZA;AAOA;AACA;AAWA,MAAMuM,aAA0B,IAAI,+CAAAf,CAASgB,MAAb,CAAoB;AAClDpK,YAAU;AACRrD,UAAM0N,MADE;AAERhJ,cAAU,IAFF;AAGRiJ,eAAW,CAHH;AAIRC,eAAW,EAJH;AAKRC,UAAM,IALE;AAMRC,eAAW,IANH;AAORC,YAAQ;AAPA,GADwC;AAUlDzK,SAAO;AACLtD,UAAM0N,MADD;AAELhJ,cAAU,IAFL;AAGLoJ,eAAW,IAHN;AAILF,eAAW,EAJN;AAKLC,UAAM,IALD;AAMLE,YAAQ;AANH,GAV2C;AAkBlDxK,aAAW;AACTvD,UAAM0N,MADG;AAETG,UAAM,IAFG;AAGTD,eAAW;AAHF,GAlBuC;AAuBlDpK,YAAU;AACRxD,UAAM0N,MADE;AAERG,UAAM,IAFE;AAGRD,eAAW;AAHH,GAvBwC;AA4BlD5K,YAAU;AACRhD,UAAM0N,MADE;AAERhJ,cAAU,IAFF;AAGRiJ,eAAW,CAHH;AAIRC,eAAW;AAJH,GA5BwC;AAkClDI,QAAM;AACJhO,UAAM0N;AADF;AAlC4C,CAApB,CAAhC;AAuCAF,WAAWS,GAAX,CAAe,YAAf,EAA6B,IAA7B;AAEAT,WAAWU,OAAX,GAAqB;AACnBjN,gBAAc,CACZ,KADY,EAEZ,UAFY,EAGZ,WAHY,EAIZ,UAJY,EAKZ,OALY,EAMZ,WANY,EAOZ,WAPY,CADK;AAWnBkN,gBAAc,CAAC,UAAD,EAAa,WAAb,EAA0B,UAA1B,EAAsC,OAAtC,EAA+C,UAA/C,CAXK;;AAanBC,qBAAmBC,WAAnB,EAA0C;AACxC,QAAIC,MAAMC,OAAN,CAAcF,WAAd,CAAJ,EAAgC;AAC9B,aAAOA,YAAYpF,GAAZ,CAAgBuF,WAAW;AAChC,eAAO,KAAKvN,YAAL,CAAkBwN,MAAlB,CACL,CAACC,GAAD,EAAMC,KAAN,KAAgB;AACdD,cAAIC,KAAJ,IAAaH,QAAQG,KAAR,CAAb;AACA,iBAAOD,GAAP;AACD,SAJI,EAKL,EALK,CAAP;AAOD,OARM,CAAP;AASD,KAVD,MAUO;AACL,aAAOlB,WAAWU,OAAX,CAAmBjN,YAAnB,CAAgCwN,MAAhC,CACL,CAACC,GAAD,EAAMC,KAAN,KAAgB;AACdD,YAAIC,KAAJ,IAAaN,YAAYM,KAAZ,CAAb;AACA,eAAOD,GAAP;AACD,OAJI,EAKL,EALK,CAAP;AAOD;AACF,GAjCkB;;AAmCnBE,qBAAmBxO,IAAnB,EAAyB;AACvB,WAAOoN,WAAWU,OAAX,CAAmBC,YAAnB,CAAgCM,MAAhC,CACL,CAACC,GAAD,EAAMC,KAAN,KAAgB;AACdD,UAAIC,KAAJ,IAAavO,KAAKuO,KAAL,CAAb;AACA,aAAOD,GAAP;AACD,KAJI,EAKL,EALK,CAAP;AAOD;;AA3CkB,CAArB;AA8CA,MAAM;AAAE5L,QAAF;AAAU+L,YAAV;AAAsBC;AAAtB,IAAoC,6CAAAzC,CAAOC,GAAP,CAAW,QAAX,CAA1C;AAEAkB,WAAWuB,GAAX,CAA8B,MAA9B,EAAsC,UAASC,IAAT,EAAe;AACnDC,EAAA,6CAAAA,CAAOC,WAAP,CAAmBpM,MAAnB,EAA2B,CAACL,GAAD,EAAM0M,KAAN,KAAgB;AACzC,QAAI1M,GAAJ,EAAS,OAAOuM,KAAKvM,GAAL,CAAP;AAET,UAAMuL,OAAQ,KAAKA,IAAL,GAAYmB,MAAM9N,QAAN,CAAe,QAAf,CAA1B;AAEA4N,IAAA,6CAAAA,CAAOG,MAAP,CACE,KAAKpM,QADP,EAEEgL,IAFF,EAGEa,UAHF,EAIE/L,MAJF,EAKEgM,SALF,EAME,CAACrM,GAAD,EAAM4M,UAAN,KAAqB;AACnB,UAAI5M,GAAJ,EAAS,OAAOuM,KAAKvM,GAAL,CAAP;AACT,WAAKO,QAAL,GAAgBqM,WAAWhO,QAAX,CAAoB,QAApB,CAAhB;AACA2N;AACD,KAVH;AAYD,GAjBD;AAkBD,CAnBD;;AAqBAxB,WAAW8B,OAAX,CAAmBC,aAAnB,GAAmC,UAASvM,QAAT,EAA2B;AAC5D,SAAO,IAAIwM,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC1M,eAAWA,SAAS6K,IAAT,EAAX;AACA,QAAI,CAAC7K,QAAL,EACE,OAAO0M,OAAO,IAAIC,KAAJ,CAAU,uCAAV,CAAP,CAAP;AAEFV,IAAA,6CAAAA,CAAOG,MAAP,CACEpM,QADF,EAEE,KAAKgL,IAFP,EAGEa,UAHF,EAIE/L,MAJF,EAKEgM,SALF,EAME,CAACrM,GAAD,EAAM4M,UAAN,KAAqB;AACnB,UAAI5M,GAAJ,EAAS,OAAOiN,OAAOjN,GAAP,CAAP;AACTgN,cAAQ,KAAKzM,QAAL,KAAkBqM,WAAWhO,QAAX,CAAoB,QAApB,CAA1B;AACD,KATH;AAWD,GAhBM,CAAP;AAiBD,CAlBD;;AAoBA,+DAAe,+CAAAoL,CAASmD,KAAT,CAA0C,MAA1C,EAAkDpC,UAAlD,CAAf,E;;;;;;;;;;;;;;;;;;;ACrJA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA,MAAMqC,SAAmBC,KAAKC,KAAL,CAAW,gEAAX,EAA0BC,MAA1B,CAAkCC,KAAD,IACxD,OAAOpI,IAAP,CAAYoI,KAAZ,CADuB,CAAzB;;AAIA,MAAMC,cAAuB,CAACjD,GAAD,EAAM7K,GAAN,EAAW4M,IAAX,KAAoB;AAC/CnC,EAAA,+CAAAA,CAASsD,YAAT,CAAsB,KAAtB,EAA6B;AAAEC,aAAS;AAAX,GAA7B,EAAiD,CAAC3N,GAAD,EAAMrC,IAAN,EAAYiQ,IAAZ,KAAqB;AACpE,QAAI5N,GAAJ,EAAS,OAAOuM,KAAKvM,GAAL,CAAP;;AACT,QAAIrC,IAAJ,EAAU;AACR6M,UAAI7M,IAAJ,GAAWA,IAAX;AACD;;AACD4O;AACD,GAND,EAMG/B,GANH,EAMQ7K,GANR,EAMa4M,IANb;AAOD,CARD;;AAUA,MAAMsB,aAAsB,CAACrD,GAAD,EAAM7K,GAAN,EAAW4M,IAAX,KAAoB;AAC9C,QAAMuB,UAA0B,EAAhC;AACA,QAAMC,UAAoB,EAA1B;AACA,QAAMC,QAAQ,IAAI,kEAAJ,EAAd;;AACA,QAAMC,sCAAyB,mEAAzB,CAAN;;AAEA,MAAIzD,IAAI7M,IAAR,EAAc;AACZ,UAAM;AAAEA;AAAF,QAAW6M,GAAjB;AACA7M,SAAKgB,GAAL,GAAWhB,KAAKgB,GAAL,CAASC,QAAT,EAAX;AACAqP,sBAAkBzR,YAAlB,GAAiCmB,IAAjC;AACD;;AAED,QAAMkK,QAAQ,sEAAAR,CAAe4G,iBAAf,CAAd;AAEA,QAAMC,WACJ,2DAAC,oDAAD;AAAU,WAAOrG;AAAjB,KACE,2DAAC,yDAAD;AAAc,cAAU2C,IAAI2D,WAA5B;AAAyC,aAASL;AAAlD,KACE,2DAAC,oDAAD,OADF,CADF,CADF;;AAQA,MAAIA,QAAQM,GAAZ,EAAiB;AACfzO,QAAI0O,QAAJ,CAAaP,QAAQQ,MAAR,IAAkB,GAA/B,EAAoCR,QAAQM,GAA5C;AACD,GAFD,MAEO;AACLvG,UAAMG,OAAN,CAAc,wDAAd,EAAwB6C,IAAxB,CAA6BnM,IAA7B,CAAkC,MAAM;AACtC,YAAM6P,OAAQ;;;;;;;;;YASRP,MAAMQ,YAAN,EAAqB;+CACcnB,KAAKoB,SAAL,CACnC5G,MAAM6G,QAAN,EADmC,CAEnC;;;;2BAIe,uEAAAC,CAAeT,QAAf,CAAyB;;YAExCd,OACC9L,KADD,GAECsN,OAFD,GAGCpI,GAHD,CAGKqI,aAAa;AAChB,eAAQ,gBAAeA,SAAU,aAAjC;AACD,OALD,EAMCC,IAND,CAMM,IANN,CAMY;;;OAxBlB;AA4BAnP,UAAIoP,IAAJ,CAASR,IAAT;AACD,KA9BD;AA+BAI,IAAA,uEAAAA,CAAeT,QAAf;AACArG,UAAMK,KAAN;AACD;AACF,CA3DD;;AA6DA,+DAAe,CAACuF,WAAD,EAAcI,UAAd,CAAf,E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5FA;AACA;AAEA;AACA;AACA;AAEA;AAIA,MAAMmB,SAAS,sDAAAC,EAAf;AAEA,MAAMC,UAA0B,+CAAA9E,CAASsD,YAAT,CAAsB,KAAtB,EAA6B;AAC3DC,WAAS;AADkD,CAA7B,CAAhC;AAIA,MAAMwB,gBAAgB;AACpBC,YAAU,IADU;AAEpBC,WAAS,IAAI7J,IAAJ,CACPA,KAAK8J,GAAL,KAAaC,OAAOC,QAAP,CAAgB,6CAAA5F,CAAOC,GAAP,CAAW,iBAAX,CAAhB,CADN,CAFW;AAKpB4F,UAAQ;AALY,CAAtB;AAQA,MAAMC,aAA0B;AAAEC,aAAW,6CAAA/F,CAAOC,GAAP,CAAW,eAAX;AAAb,CAAhC;;AAEA,MAAM+F,sBAAsC,CAACpF,GAAD,EAAM7K,GAAN,EAAW4M,IAAX,KAAoB;AAC9D,MAAI,CAAC,+CAAAvC,CAAS6F,KAAT,CAAeC,QAAf,CAAwBC,OAAxB,CAAgCvF,IAAIlL,MAAJ,CAAWhC,EAA3C,CAAL,EAAqD;AACnD,UAAM0C,MAAM,IAAIkN,KAAJ,CAAU,qBAAV,CAAZ;AACAlN,QAAIgQ,UAAJ,GAAiB,GAAjB;AACA,WAAOzD,KAAKvM,GAAL,CAAP;AACD;;AACDuM;AACD,CAPD;;AASAyC,OAAOnF,GAAP,CAAW,GAAX,EAAgBqF,OAAhB,EAAyB,CAAC1E,GAAD,EAAM7K,GAAN,EAAW4M,IAAX,KAAoB;AAC3CnO,EAAA,oDAAAA,CAAKkH,IAAL,GACG7G,IADH,GAEGC,IAFH,CAESuR,QAAD,IAAuB;AAC3B,UAAMC,gBAAgB,oDAAA9R,CAAKuN,kBAAL,CAAwBsE,QAAxB,CAAtB;AAEAtQ,QAAIwQ,IAAJ,CAASD,aAAT;AACD,GANH,EAOGnQ,KAPH,CAOSwM,IAPT;AAQD,CATD;AAWAyC,OAAOnF,GAAP,CAAW,MAAX,EAAmBqF,OAAnB,EAA4BU,mBAA5B,EAAiD,CAACpF,GAAD,EAAM7K,GAAN,EAAW4M,IAAX,KAAoB;AACnE,QAAM;AAAEjP;AAAF,MAASkN,IAAIlL,MAAnB;AAEAlB,EAAA,oDAAAA,CAAKG,QAAL,CAAcjB,EAAd,EACGmB,IADH,GAEGC,IAFH,CAESqN,OAAD,IAAoB;AACxB,UAAMpO,OAAO,oDAAAS,CAAKuN,kBAAL,CAAwBI,OAAxB,CAAb;AACApM,QAAIwQ,IAAJ,CAASxS,IAAT;AACD,GALH,EAMGoC,KANH,CAMSwM,IANT;AAOD,CAVD;AAYAyC,OAAOtP,IAAP,CAAY,WAAZ,EAAyBwP,OAAzB,EAAkCU,mBAAlC,EAAuD,CAACpF,GAAD,EAAM7K,GAAN,EAAW4M,IAAX,KAAoB;AACzE,QAAM;AAAEjP;AAAF,MAASkN,IAAIlL,MAAnB;AACA,QAAM8Q,OAAkC,EAAxC;;AAEA,OAAK,MAAMC,GAAX,IAAkB7F,IAAI4F,IAAtB,EAA4B;AAC1B,QAAI5F,IAAI4F,IAAJ,CAASC,GAAT,CAAJ,EAAmBD,KAAKC,GAAL,IAAY7F,IAAI4F,IAAJ,CAASC,GAAT,CAAZ;AACpB,GANwE,CAQzE;;;AACA,MAAID,KAAK7P,QAAT,EAAmB;AACjBnC,IAAA,oDAAAA,CAAKG,QAAL,CAAcjB,EAAd,EACGoB,IADH,CACQ4R,WAAW;AACfA,cAAS9E,GAAT,CAAa4E,IAAb;AACAE,cACGC,IADH,GAEG7R,IAFH,CAEQ8R,kBAAkB;AACtB7Q,YAAIoP,IAAJ,CAAS,oDAAA3Q,CAAKuN,kBAAL,CAAwB6E,cAAxB,CAAT;AACD,OAJH,EAKGzQ,KALH,CAKSwM,IALT;AAMD,KATH,EAUGxM,KAVH,CAUSwM,IAVT;AAWD,GAZD,MAYO;AACLnO,IAAA,oDAAAA,CAAKqS,iBAAL,CAAuBnT,EAAvB,EAA2B8S,IAA3B,EAAiC;AAAEM,WAAK;AAAP,KAAjC,EACGhS,IADH,CACQqN,WAAW;AACf,YAAMpO,OAAO,oDAAAS,CAAKuN,kBAAL,CAAwBI,OAAxB,CAAb;AACApM,UAAIwQ,IAAJ,CAASxS,IAAT;AACD,KAJH,EAKGoC,KALH,CAKSwM,IALT;AAMD;AACF,CA7BD;AA+BAyC,OAAOtP,IAAP,CAAY,eAAZ,EAA6B,CAAC8K,GAAD,EAAM7K,GAAN,EAAW4M,IAAX,KAAoB;AAC/C,QAAMoE,UAAU,IAAI,oDAAJ,CAASnG,IAAI4F,IAAb,CAAhB;AACAO,UACGJ,IADH,GAEG7R,IAFH,CAEQqN,WAAW;AACf,UAAMpO,OAAO,oDAAAS,CAAKuN,kBAAL,CAAwBI,OAAxB,CAAb;AACA,UAAMnB,UAAU;AAAEtN,UAAIK,KAAKgB;AAAX,KAAhB;AAEAiS,IAAA,mDAAAA,CAAIC,IAAJ,CAASjG,OAAT,EAAkB,6CAAAhB,CAAOC,GAAP,CAAW,YAAX,CAAlB,EAA4C6F,UAA5C,EAAwD,CAAC1P,GAAD,EAAMyK,KAAN,KAAgB;AACtE,UAAIzK,GAAJ,EAAS,OAAOuM,KAAKvM,GAAL,CAAP;AAETL,UAAImR,MAAJ,CAAW,cAAX,EAA2BrG,KAA3B,EAAkC0E,aAAlC;AACAxP,UAAIoP,IAAJ,CAASpR,IAAT;AACD,KALD;AAMD,GAZH,EAaGoC,KAbH,CAaSwM,IAbT;AAcD,CAhBD;AAkBAyC,OAAOtP,IAAP,CAAY,QAAZ,EAAsB,CAAC8K,GAAD,EAAM7K,GAAN,EAAW4M,IAAX,KAAoB;AACxC,QAAM;AACJ6D,UAAM;AAAExP,cAAF;AAAYL;AAAZ;AADF,MAEFiK,GAFJ;;AAIA,MAAI,CAAC5J,QAAD,IAAa,CAACL,QAAlB,EAA4B;AAC1B,UAAMP,MAAM,IAAIkN,KAAJ,CACV,yCADU,CAAZ;AAGAlN,QAAIgQ,UAAJ,GAAiB,GAAjB;AACA,WAAOzD,KAAKvM,GAAL,CAAP;AACD;;AAED5B,EAAA,oDAAAA,CAAK2S,OAAL,CAAa;AAAEnQ;AAAF,GAAb,EAA2B,CAACZ,GAAD,EAAM+L,OAAN,KAAkB;AAC3C,QAAI/L,GAAJ,EAAS,OAAOuM,KAAKvM,GAAL,CAAP;;AACT,QAAI,CAAC+L,OAAL,EAAc;AACZ,YAAM/L,MAAM,IAAIkN,KAAJ,CACV,iCADU,CAAZ;AAGAlN,UAAIgQ,UAAJ,GAAiB,GAAjB;AACA,aAAOzD,KAAKvM,GAAL,CAAP;AACD;;AAED+L,YACGe,aADH,CACiBvM,QADjB,EAEG7B,IAFH,CAEQsS,aAAa;AACjB,UAAI,CAACA,SAAL,EAAgB;AACd,cAAMhR,MAAM,IAAIkN,KAAJ,CACV,uBADU,CAAZ;AAGAlN,YAAIgQ,UAAJ,GAAiB,GAAjB;AACA,eAAOzD,KAAKvM,GAAL,CAAP;AACD;;AAED,YAAMrC,OAAO,oDAAAS,CAAKuN,kBAAL,CAAwBI,QAAQkF,QAAR,EAAxB,CAAb;AAEAL,MAAA,mDAAAA,CAAIC,IAAJ,CACE;AAAEvT,YAAIK,KAAKgB;AAAX,OADF,EAEE,6CAAAiL,CAAOC,GAAP,CAAW,YAAX,CAFF,EAGE6F,UAHF,EAIE,CAAC1P,GAAD,EAAMyK,KAAN,KAAgB;AACd,YAAIzK,GAAJ,EAAS,OAAOuM,KAAKvM,GAAL,CAAP;AAETL,YAAImR,MAAJ,CAAW,cAAX,EAA2BrG,KAA3B,EAAkC0E,aAAlC;AACAxP,YAAIwQ,IAAJ,CAASxS,IAAT;AACD,OATH;AAWD,KAxBH,EAyBGoC,KAzBH,CAyBSwM,IAzBT;AA0BD,GApCD;AAqCD,CAlDD;AAoDAyC,OAAOtP,IAAP,CAAY,SAAZ,EAAuB,CAAC8K,GAAD,EAAM7K,GAAN,EAAW4M,IAAX,KAAoB;AACzC5M,MAAIuR,WAAJ,CAAgB,cAAhB;AACA,SAAO1G,IAAI7M,IAAX;AACAgC,MAAI2O,MAAJ,CAAW,GAAX,EAAgBS,IAAhB,CAAqB,YAArB;AACD,CAJD;AAMAC,OAAOpL,MAAP,CAAc,aAAd,EAA6BsL,OAA7B,EAAsCU,mBAAtC,EAA2D,CAACpF,GAAD,EAAM7K,GAAN,EAAW4M,IAAX,KAAoB;AAC7E,QAAM;AAAEjP;AAAF,MAASkN,IAAIlL,MAAnB;AACAlB,EAAA,oDAAAA,CAAK+S,iBAAL,CAAuB7T,EAAvB,EAA2ByC,KAA3B,CAAiCwM,IAAjC;AACD,CAHD;AAKA,+DAAeyC,MAAf,E;;;;;;;;;;;;;;;;;;;;;;;;;AC3KA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA,MAAMtF,MAAM,8CAAA0H,EAAZ;AAEA1H,IAAI2H,OAAJ,CAAY,cAAZ;;AAEA,IAAI,KAAJ,EAA2C,EAE1C;;AAED3H,IAAIS,GAAJ,CAAQ,oDAAAmH,CAAa,2CAAAC,CAAKvE,OAAL,CAAa,sBAAb,CAAb,CAAR;AACAtD,IAAIS,GAAJ,CAAQ,SAAR,EAAmB,8CAAAiH,CAAQI,MAAR,CAAe,QAAf,CAAnB;AACA9H,IAAIS,GAAJ,CAAQ,oDAAAsH,CAAa,6CAAA7H,CAAOC,GAAP,CAAW,gBAAX,CAAb,CAAR;AACAH,IAAIS,GAAJ,CAAQ,8CAAAiH,CAAQjB,IAAR,EAAR;AACAzG,IAAIS,GAAJ,CAAQ,8CAAAiH,CAAQM,UAAR,CAAmB;AAAEC,YAAU;AAAZ,CAAnB,CAAR;AACA,0DAAAC,CAAclI,GAAd;AAEAA,IAAIS,GAAJ,CAAQ,OAAR,EAAiB,gDAAjB;AACAT,IAAIS,GAAJ,CAAQ,IAAR,EAAc,2CAAd;;AAEA,MAAM0H,eAAoC,CAAC7R,GAAD,EAAMwK,GAAN,EAAW7K,GAAX,EAAgB4M,IAAhB,KAAyB;AACjE5M,MAAI2O,MAAJ,CAAWtO,IAAIgQ,UAAJ,IAAkB,GAA7B,EAAkCjB,IAAlC,CAAuC/O,IAAI8R,OAA3C;AACD,CAFD;;AAGApI,IAAIS,GAAJ,CAAQ0H,YAAR;AAEA,+DAAenI,GAAf,E;;;;;;;;;;;ACjCA,kC;;;;;;;;;;;ACAA,mC;;;;;;;;;;;ACAA,0C;;;;;;;;;;;ACAA,mC;;;;;;;;;;;ACAA,oC;;;;;;;;;;;ACAA,mC;;;;;;;;;;;ACAA,yC;;;;;;;;;;;ACAA,wC;;;;;;;;;;;ACAA,qC;;;;;;;;;;;ACAA,qC;;;;;;;;;;;ACAA,yC;;;;;;;;;;;ACAA,iC;;;;;;;;;;;ACAA,qC;;;;;;;;;;;ACAA,kC;;;;;;;;;;;ACAA,6C;;;;;;;;;;;ACAA,6C;;;;;;;;;;;ACAA,wC;;;;;;;;;;;ACAA,yC;;;;;;;;;;;ACAA,6C;;;;;;;;;;;ACAA,kC;;;;;;;;;;;ACAA,uC;;;;;;;;;;;ACAA,+C;;;;;;;;;;;ACAA,0C;;;;;;;;;;;ACAA,8C;;;;;;;;;;;ACAA,gC","file":"server.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/server/index.ts\");\n","module.exports = function(originalModule) {\r\n\tif (!originalModule.webpackPolyfill) {\r\n\t\tvar module = Object.create(originalModule);\r\n\t\t// module.parent = undefined by default\r\n\t\tif (!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"exports\", {\r\n\t\t\tenumerable: true\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n","import React, { SFC } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport styled from \"styledComponents\";\nimport { rgba } from \"polished\";\n\nimport { THeaderProps } from \"./types\";\n\nconst H = styled.header`\n  display: flex;\n  flex: 0 0 ${({ theme }) => theme.scale.second};\n  justify-content: center;\n  align-items: center;\n  background-color: white;\n  box-shadow: 0 4px 16px ${({ theme }) => rgba(theme.colors.quaternary, 0.54)};\n`;\n\nconst UserInfo = styled.section``;\n\nconst Nav = styled.nav`\n  margin: 0 ${({ theme }) => theme.scale.first} 0 auto;\n`;\n\nconst StyledLink = styled(Link)`\n  text-decoration: none;\n  color: rgba(0, 0, 0, 0.54);\n  :hover {\n    color: rgba(0, 0, 0, 0.87);\n  }\n`;\n\nconst Header: SFC<THeaderProps> = props => {\n  if ([\"/login\", \"/registration\"].includes(props.location.pathname))\n    return null;\n\n  return (\n    <H>\n      <UserInfo />\n      <Nav>\n        <StyledLink to=\"/logout\">Logout</StyledLink>\n      </Nav>\n    </H>\n  );\n};\n\nexport default Header;\n","import React, { SFC } from \"react\";\nimport { Route, Redirect, Switch, withRouter } from \"react-router-dom\";\nimport { hot } from \"react-hot-loader\";\nimport styled, { ThemeProvider } from \"styledComponents\";\nimport { connect } from \"react-redux\";\nimport axios from \"axios\";\nimport { rgba } from \"polished\";\n\nimport UserList from \"./screens/UserList\";\nimport SingleUser from \"./screens/SingleUser\";\nimport Login from \"./screens/Login\";\nimport Registration from \"./screens/Registration\";\nimport Logout from \"./screens/Logout\";\nimport EditProfile from \"./screens/EditProfile\";\nimport theme from \"../theme\";\nimport Header from \"./components/Header\";\n\nimport { TGlobalState } from \"../types\";\nimport { TRootProps, TMainProps } from \"./types\";\n\nconst Main = styled<TMainProps, \"main\">(\"main\")`\npadding-top: ${({ theme }) => theme.scale.second}\n  flex-grow: 1;\n  background-color: ${({ theme, location }) => {\n    return ![\"/login\", \"/registration\"].includes(location.pathname)\n      ? rgba(theme.colors.quaternary, 0.12)\n      : \"white\";\n  }};\n  border-top: 1px solid transparent;\n`;\n\nconst MainInner = styled.div`\n  max-width: 630px;\n  margin: 0 auto;\n`;\n\nconst Root: SFC<TRootProps> = props => (\n  <ThemeProvider theme={theme}>\n    <>\n      <Header loggedInUser={props.loggedInUser} location={props.location} />\n      <Main location={props.location}>\n        <MainInner>\n          <Switch>\n            <Route exact path=\"/registration\" component={Registration} />\n            <Route exact path=\"/login\" component={Login} />\n            <Route exact path=\"/logout\" component={Logout} />\n            <Route exact path=\"/\" component={UserList} />\n            <Route exact path=\"/:id\" component={SingleUser} />\n            <Route exact path=\"/:id/edit\" component={EditProfile} />\n            <Route render={props => <h2>404 Not Found</h2>} />\n          </Switch>\n        </MainInner>\n      </Main>\n    </>\n  </ThemeProvider>\n);\n\nfunction mapStateToProps(state: TGlobalState) {\n  return {\n    loggedInUser: state.loggedInUser\n  };\n}\n\nexport default hot(module)(withRouter(connect(mapStateToProps)(Root)));\n","import {\n  userFetchTypes,\n  userUpdateTypes,\n  TUserFetchRequestedActionCreator,\n  TUserFetchSucceededActionCreator,\n  TUserFetchFailedActionCreator,\n  TUserUpdateSucceededActionCreator\n} from \"./types\";\n\nexport const userFetchRequested: TUserFetchRequestedActionCreator = id => {\n  return {\n    type: userFetchTypes.USER_FETCH_REQUESTED,\n    id\n  };\n};\n\nexport const userFetchSucceeded: TUserFetchSucceededActionCreator = user => {\n  return {\n    type: userFetchTypes.USER_FETCH_SUCCEEDED,\n    user\n  };\n};\n\nexport const userFetchFailed: TUserFetchFailedActionCreator = error => {\n  return {\n    type: userFetchTypes.USER_FETCH_FAILED,\n    error\n  };\n};\n\nexport const userUpdateSucceeded: TUserUpdateSucceededActionCreator = user => {\n  return {\n    type: userUpdateTypes.USER_UPDATE_SUCCEEDED,\n    user\n  };\n};\n","import { TFetchUserApiService } from \"./types\";\nimport { TUser } from \"../../../types\";\nimport { TUserModel } from \"../../../../server/models/User/types\";\n\nconst fetchUserService: TFetchUserApiService = id => {\n  if (__SERVER__) {\n    const User = require(\"../../../../server/models/User\")\n      .default as TUserModel;\n\n    return User.findById(id, User.publicFields)\n      .lean()\n      .then((user: TUser) => {\n        user._id = user._id.toString();\n        return user;\n      });\n  }\n};\n\nexport default fetchUserService;\n","import styled from \"styledComponents\";\n\nimport { BaseButton } from \"Components/styled\";\n\nexport const CancelButton = BaseButton.extend`\n  background-color: ${({ theme }) => theme.colors.secondary};\n  margin-right: ${({ theme }) => theme.scale.base};\n`;\n","import React, { SFC } from \"react\";\nimport { bindActionCreators, Dispatch } from \"redux\";\nimport { connect } from \"react-redux\";\nimport { Formik, FormikValues, FormikActions } from \"formik\";\nimport { Redirect } from \"react-router-dom\";\nimport axios from \"axios\";\n\nimport {\n  SubmitButton,\n  ErrorMessage,\n  Label,\n  StyledField,\n  Title,\n  ServerErrorMessage,\n  BottomLink,\n  InputBlock,\n  BlockWrapper,\n  StyledForm\n} from \"Components/styled\";\nimport { CancelButton } from \"./components/styled\";\nimport validationSchema from \"./validationSchema\";\nimport { userFetchRequested, userUpdateSucceeded } from \"./actionCreators\";\n\nimport { TEditProfileProps, userFetchTypes } from \"./types\";\n\nfunction onSubmit(\n  props: TEditProfileProps,\n  values: FormikValues,\n  actions: FormikActions<FormikValues>\n) {\n  const {\n    match: {\n      params: { id }\n    }\n  } = props;\n  actions.setSubmitting(true);\n  delete values.serverErrorMessage;\n  axios\n    .post(`/api/${id}/edit`, values)\n    .then(res => {\n      actions.setSubmitting(false);\n      props.userUpdateSucceeded(res.data);\n      props.history.push(`/${id}`);\n    })\n    .catch(err => {\n      actions.setSubmitting(false);\n      actions.setErrors({ serverErrorMessage: err.response.data });\n    });\n}\n\nconst EditProfile: SFC<TEditProfileProps> = props => {\n  const { id: idUrlParam } = props.match.params;\n  if (!props.users.length) props.userFetchRequested(idUrlParam);\n\n  const initialValues = {\n    serverErrorMessage: null,\n    password: \"\",\n    ...props.loggedInUser!\n  };\n\n  return (\n    <Formik\n      initialValues={initialValues}\n      validationSchema={validationSchema}\n      onSubmit={onSubmit.bind(null, props)}\n      render={({ errors, touched, isSubmitting }) => {\n        return !props.loggedInUser ? (\n          <Redirect to=\"/login\" />\n        ) : (\n          <>\n            <Title>Edit profile</Title>\n            {errors.serverErrorMessage && (\n              <ServerErrorMessage>\n                Server error: {errors.serverErrorMessage}\n              </ServerErrorMessage>\n            )}\n            <StyledForm>\n              <InputBlock>\n                <Label htmlFor=\"username\">\n                  Username <span>*</span>\n                </Label>\n                <br />\n                <StyledField type=\"text\" name=\"username\" id=\"username\" />\n                <ErrorMessage>\n                  {touched.username && errors.username && errors.username}\n                </ErrorMessage>\n              </InputBlock>\n              <InputBlock>\n                <Label htmlFor=\"email\">\n                  Email <span>*</span>\n                </Label>\n                <br />\n                <StyledField type=\"email\" name=\"email\" id=\"email\" />\n                <ErrorMessage>\n                  {touched.email && errors.email && errors.email}\n                </ErrorMessage>\n              </InputBlock>\n              <InputBlock>\n                <Label htmlFor=\"firstName\">First Name</Label>\n                <br />\n                <StyledField type=\"text\" name=\"firstName\" id=\"firstName\" />\n                <ErrorMessage>\n                  {touched.firstName && errors.firstName && errors.firstName}\n                </ErrorMessage>\n              </InputBlock>\n              <InputBlock>\n                <Label htmlFor=\"lastName\">Last Name</Label>\n                <br />\n                <StyledField type=\"text\" name=\"lastName\" id=\"lastName\" />\n                <ErrorMessage>\n                  {touched.lastName && errors.lastName && errors.lastName}\n                </ErrorMessage>\n              </InputBlock>\n              <BlockWrapper>\n                <InputBlock>\n                  <Label htmlFor=\"password\">\n                    Password <span>*</span>\n                  </Label>\n                  <br />\n                  <StyledField type=\"password\" name=\"password\" id=\"password\" />\n                  <ErrorMessage>\n                    {touched.password && errors.password && errors.password}\n                  </ErrorMessage>\n                </InputBlock>\n              </BlockWrapper>\n              <BlockWrapper>\n                <CancelButton\n                  onClick={() => {\n                    props.history.goBack();\n                  }}\n                >\n                  Cancel\n                </CancelButton>\n                <SubmitButton type=\"submit\" disabled={isSubmitting}>\n                  Submit\n                </SubmitButton>\n              </BlockWrapper>\n            </StyledForm>\n          </>\n        );\n      }}\n    />\n  );\n};\n\nconst actions = {\n  userFetchRequested,\n  userUpdateSucceeded\n};\n\nexport default connect(state => state, actions)(EditProfile);\n","import { TGlobalState } from \"../../../types\";\nimport {\n  TUserFetchActions,\n  TUserUpdateSucceededAction,\n  userFetchTypes,\n  userUpdateTypes\n} from \"./types\";\n\nexport default function editPropfileReducer(\n  state: TGlobalState,\n  action: TUserFetchActions | TUserUpdateSucceededAction\n) {\n  switch (action.type) {\n    case userFetchTypes.USER_FETCH_REQUESTED:\n      return { ...state, requestInProgress: true };\n    case userFetchTypes.USER_FETCH_SUCCEEDED:\n      return {\n        ...state,\n        requestInProgress: false,\n        users: [...state.users, action.user]\n      };\n    case userFetchTypes.USER_FETCH_FAILED:\n      return { ...state, requestInProgress: false, error: action.error };\n    case userUpdateTypes.USER_UPDATE_SUCCEEDED:\n      const { users } = state;\n      let idx = users.findIndex(user => user._id === action.user._id);\n      return {\n        ...state,\n        requestInProgress: false,\n        users: [...users.slice(0, idx), action.user, ...users.slice(++idx)],\n        loggedInUser: action.user\n      };\n    default:\n      return state;\n  }\n}\n","import { takeLatest, call, put } from \"redux-saga/effects\";\n\nimport fetchUserApiService from \"./apiService\";\nimport { userFetchSucceeded, userFetchFailed } from \"./actionCreators\";\n\nimport { userFetchTypes, TUserFetchRequestedAction } from \"./types\";\n\nexport function* fetchUserWorker({ id }: TUserFetchRequestedAction) {\n  try {\n    const user = yield call(fetchUserApiService, id);\n    yield put(userFetchSucceeded(user));\n  } catch (error) {\n    yield put(userFetchFailed(error));\n  }\n}\n\nexport default function* fetchUserWatcher() {\n  yield takeLatest(userFetchTypes.USER_FETCH_REQUESTED, fetchUserWorker);\n}\n","import { RouteComponentProps } from \"react-router-dom\";\n\nimport { TGlobalState, TUser } from \"../../../types\";\n\nexport interface TEditProfileProps\n  extends RouteComponentProps<{ id: string }>,\n    TGlobalState {\n  userFetchRequested: TUserFetchRequestedActionCreator;\n  userUpdateSucceeded: TUserUpdateSucceededActionCreator;\n}\n\nexport interface TFetchUserApiService {\n  (id: string): Promise<TUser | null> | void;\n}\n\n/**\n * USER FETCH\n */\n\nexport enum userFetchTypes {\n  USER_FETCH_REQUESTED = \"USER_FETCH_REQUESTED\",\n  USER_FETCH_SUCCEEDED = \"USER_FETCH_SUCCEEDED\",\n  USER_FETCH_FAILED = \"USER_FETCH_FAILED\"\n}\n\nexport interface TUserFetchRequestedAction {\n  type: userFetchTypes.USER_FETCH_REQUESTED;\n  id: string;\n}\nexport interface TUserFetchSucceededAction {\n  type: userFetchTypes.USER_FETCH_SUCCEEDED;\n  user: TUser;\n}\nexport interface TUserFetchFailedAction {\n  type: userFetchTypes.USER_FETCH_FAILED;\n  error: Error;\n}\nexport type TUserFetchActions =\n  | TUserFetchRequestedAction\n  | TUserFetchSucceededAction\n  | TUserFetchFailedAction;\n\nexport interface TUserFetchRequestedActionCreator {\n  (id: string): TUserFetchRequestedAction;\n}\nexport interface TUserFetchSucceededActionCreator {\n  (user: TUser): TUserFetchSucceededAction;\n}\nexport interface TUserFetchFailedActionCreator {\n  (error: Error): TUserFetchFailedAction;\n}\n\n/**\n * UPDATE USER\n */\n\nexport enum userUpdateTypes {\n  USER_UPDATE_SUCCEEDED = \"USER_UPDATE_SUCCEEDED\"\n}\n\nexport interface TUserUpdateSucceededAction {\n  type: userUpdateTypes.USER_UPDATE_SUCCEEDED;\n  user: TUser;\n}\n\nexport interface TUserUpdateSucceededActionCreator {\n  (user: TUser): TUserUpdateSucceededAction;\n}\n","import { object, string } from \"yup\";\n\nexport default object().shape({\n  username: string()\n    .min(3)\n    .max(30)\n    .required(),\n  email: string()\n    .email()\n    .max(60)\n    .required(),\n  firstName: string()\n    .min(2)\n    .max(30),\n  lastName: string()\n    .min(2)\n    .max(30),\n  password: string()\n    .min(6)\n    .max(30)\n});\n","import styled from \"styledComponents\";\nimport { Form } from \"formik\";\n\nexport const StyledForm = styled(Form)`\n  display: flex;\n  flex-flow: column nowrap;\n  align-items: center;\n  margin: 0 auto;\n`;\n\nexport const InputBlock = styled.div`\n  width: 300px;\n`;\n\nexport const DefaultUserMessage = styled.div`\n  margin-top: ${({ theme }) => theme.scale.base};\n  padding: ${({ theme }) => theme.scale.base};\n  color: rgba(0, 0, 0, 0.38);\n  font-weight: 100;\n  font-style: italic;\n  text-align: center;\n  > span {\n    font-weight: bold;\n  }\n`;\n","import React, { SFC } from \"react\";\nimport { Formik, FormikValues, FormikActions } from \"formik\";\nimport axios, { AxiosError } from \"axios\";\nimport { connect } from \"react-redux\";\nimport { Redirect } from \"react-router-dom\";\n\nimport {\n  Title,\n  ServerErrorMessage,\n  StyledField,\n  ErrorMessage,\n  Label,\n  SubmitButton,\n  BottomLink\n} from \"Components/styled\";\n\nimport { InputBlock, StyledForm, DefaultUserMessage } from \"./components\";\nimport validationSchema from \"./validationSchema\";\nimport * as actionCreators from \"../../../actionCreators\";\n\nimport { TLoginProps } from \"./types\";\nimport { TGlobalState } from \"../../../types\";\n\nlet initialValues = {\n  username: \"\",\n  password: \"\",\n  serverErrorMessage: \"\"\n};\n\nif (__CLIENT__ && !localStorage.notFirstVisit) {\n  initialValues = {\n    username: \"elon\",\n    password: \"123123\",\n    serverErrorMessage: \"\"\n  };\n  localStorage.setItem(\"notFirstVisit\", \"1\");\n}\n\nfunction onSubmit(\n  props: TLoginProps,\n  values: FormikValues,\n  formikBag: FormikActions<FormikValues>\n) {\n  formikBag.setSubmitting(true);\n  delete values.serverErrorMessage;\n  axios\n    .post(\"/api/login\", values)\n    .then(res => {\n      formikBag.setSubmitting(false);\n      props.addLoggedInUser(res.data);\n      props.history.replace(\"/\");\n    })\n    .catch((err: AxiosError) => {\n      formikBag.setSubmitting(false);\n      formikBag.setErrors({ serverErrorMessage: err!.response!.data });\n    });\n}\n\nconst Login: SFC<TLoginProps> = props => (\n  <Formik\n    initialValues={initialValues}\n    validationSchema={validationSchema}\n    onSubmit={onSubmit.bind(null, props)}\n    render={({ touched, errors, isSubmitting }) => {\n      return props.loggedInUser ? (\n        <Redirect to=\"/\" />\n      ) : (\n        <>\n          <Title>Login</Title>\n          {errors.serverErrorMessage && (\n            <ServerErrorMessage>\n              Server error: {errors.serverErrorMessage}\n            </ServerErrorMessage>\n          )}\n          <StyledForm>\n            <InputBlock>\n              <Label htmlFor=\"username\">\n                Username <span>*</span>\n              </Label>\n              <br />\n              <StyledField type=\"text\" name=\"username\" id=\"username\" />\n              <ErrorMessage>\n                {touched.username && errors.username && errors.username}\n              </ErrorMessage>\n            </InputBlock>\n            <InputBlock>\n              <Label htmlFor=\"password\">\n                Password <span>*</span>\n              </Label>\n              <br />\n              <StyledField type=\"password\" name=\"password\" id=\"password\" />\n              <ErrorMessage>\n                {touched.password && errors.password && errors.password}\n              </ErrorMessage>\n            </InputBlock>\n            <SubmitButton>Log in</SubmitButton>\n            <BottomLink to=\"/registration\">\n              ...or register a new account if you don't have one.\n            </BottomLink>\n            <DefaultUserMessage>\n              The default profile username is <span>elon</span> and the password\n              is <span>123123</span>\n            </DefaultUserMessage>\n          </StyledForm>\n        </>\n      );\n    }}\n  />\n);\n\nfunction mapStateToProps(state: TGlobalState) {\n  return {\n    loggedInUser: state.loggedInUser\n  };\n}\n\nexport default connect(mapStateToProps, actionCreators)(Login);\n","import { object, string } from \"yup\";\n\nexport default object().shape({\n  username: string()\n    .min(3)\n    .max(30)\n    .required(),\n  password: string()\n    .min(6)\n    .max(30)\n    .required()\n});\n","import React, { Component } from \"react\";\nimport { Redirect } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { connect } from \"react-redux\";\nimport { Dispatch, bindActionCreators } from \"redux\";\n\nimport { removeLoggedInUser } from \"../../../actionCreators\";\n\nimport { TLogoutProps, TLogoutState } from \"./types\";\nimport { TGlobalState, TRemoveLoggedInUserAction } from \"../../../types\";\n\nclass Logout extends Component<TLogoutProps, TLogoutState> {\n  state: TLogoutState = { loggedOut: false };\n\n  componentDidMount() {\n    axios\n      .post(\"/api/logout\")\n      .then(() => {\n        this.props.removeLoggedInUser();\n        this.setState({ loggedOut: true });\n      })\n      .catch(err => {\n        console.error(err);\n      });\n  }\n\n  render() {\n    return this.state.loggedOut ? <Redirect to=\"/login\" /> : \"Redirecting...\";\n  }\n}\n\nfunction mapStateToProps(state: TGlobalState) {\n  return {\n    loggedInUser: state.loggedInUser\n  };\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<TRemoveLoggedInUserAction>) {\n  return bindActionCreators({ removeLoggedInUser }, dispatch);\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Logout);\n","import React, { SFC } from \"react\";\nimport { Formik, FormikActions, FormikValues } from \"formik\";\nimport yup from \"yup\";\nimport styled from \"styledComponents\";\nimport axios from \"axios\";\nimport { connect } from \"react-redux\";\nimport { Redirect } from \"react-router-dom\";\n\nimport {\n  SubmitButton,\n  ErrorMessage,\n  Label,\n  StyledField,\n  Title,\n  ServerErrorMessage,\n  BottomLink,\n  InputBlock,\n  BlockWrapper,\n  StyledForm\n} from \"Components/styled\";\nimport validationSchema from \"./validationSchema\";\nimport { addLoggedInUser } from \"../../../actionCreators\";\n\nimport { TGlobalState } from \"../../../types\";\nimport { TRegistrationProps } from \"./types\";\n\nconst initialValues = {\n  username: \"\",\n  email: \"\",\n  firstName: \"\",\n  lastName: \"\",\n  password: \"\",\n  serverErrorMessage: \"\"\n};\n\nfunction onSubmit(\n  props: TRegistrationProps,\n  values: FormikValues,\n  formikBag: FormikActions<FormikValues>\n) {\n  formikBag.setSubmitting(true);\n  axios\n    .post(\"/api/registration\", values)\n    .then(res => {\n      formikBag.setSubmitting(false);\n      props.addLoggedInUser(res.data);\n      props.history.replace(\"/\");\n    })\n    .catch(err => {\n      formikBag.setSubmitting(false);\n      formikBag.setErrors({ serverErrorMessage: err.response.data });\n    });\n}\n\nconst Registration: SFC<TRegistrationProps> = props => {\n  return (\n    <Formik\n      initialValues={initialValues}\n      validationSchema={validationSchema}\n      onSubmit={onSubmit.bind(null, props)}\n      render={({ touched, errors, isSubmitting }) => {\n        return props.loggedInUser ? (\n          <Redirect to=\"/\" />\n        ) : (\n          <>\n            <Title> Registration </Title>\n            {errors.serverErrorMessage && (\n              <ServerErrorMessage>\n                Server error: {errors.serverErrorMessage}\n              </ServerErrorMessage>\n            )}\n            <StyledForm>\n              <InputBlock>\n                <Label htmlFor=\"username\">\n                  Username <span>*</span>\n                </Label>\n                <br />\n                <StyledField type=\"text\" name=\"username\" id=\"username\" />\n                <ErrorMessage>\n                  {touched.username && errors.username && errors.username}\n                </ErrorMessage>\n              </InputBlock>\n              <InputBlock>\n                <Label htmlFor=\"email\">\n                  Email <span>*</span>\n                </Label>\n                <br />\n                <StyledField type=\"email\" name=\"email\" id=\"email\" />\n                <ErrorMessage>\n                  {touched.email && errors.email && errors.email}\n                </ErrorMessage>\n              </InputBlock>\n              <InputBlock>\n                <Label htmlFor=\"firstName\">First Name</Label>\n                <br />\n                <StyledField type=\"text\" name=\"firstName\" id=\"firstName\" />\n                <ErrorMessage>\n                  {touched.firstName && errors.firstName && errors.firstName}\n                </ErrorMessage>\n              </InputBlock>\n              <InputBlock>\n                <Label htmlFor=\"lastName\">Last Name</Label>\n                <br />\n                <StyledField type=\"text\" name=\"lastName\" id=\"lastName\" />\n                <ErrorMessage>\n                  {touched.lastName && errors.lastName && errors.lastName}\n                </ErrorMessage>\n              </InputBlock>\n              <BlockWrapper>\n                <InputBlock>\n                  <Label htmlFor=\"password\">\n                    Password <span>*</span>\n                  </Label>\n                  <br />\n                  <StyledField type=\"password\" name=\"password\" id=\"password\" />\n                  <ErrorMessage>\n                    {touched.password && errors.password && errors.password}\n                  </ErrorMessage>\n                </InputBlock>\n              </BlockWrapper>\n              <BlockWrapper>\n                <SubmitButton type=\"submit\" disabled={isSubmitting}>\n                  Submit\n                </SubmitButton>\n              </BlockWrapper>\n              <BlockWrapper>\n                <BottomLink to=\"/login\">\n                  …or log in if you have an account.\n                </BottomLink>\n              </BlockWrapper>\n            </StyledForm>\n          </>\n        );\n      }}\n    />\n  );\n};\n\nfunction mapStateToProps(state: TGlobalState) {\n  return {\n    loggedInUser: state.loggedInUser\n  };\n}\n\nexport default connect(mapStateToProps, { addLoggedInUser })(Registration);\n","import { object, string } from \"yup\";\n\nexport default object().shape({\n  username: string()\n    .min(3)\n    .max(30)\n    .required(),\n  email: string()\n    .email()\n    .max(60)\n    .required(),\n  firstName: string()\n    .min(2)\n    .max(30),\n  lastName: string()\n    .min(2)\n    .max(30),\n  password: string()\n    .min(6)\n    .max(30)\n    .required()\n});\n","import {\n  TFetchSingleUserRequestedActionCreator,\n  TFetchSingleUserSucceededActionCreator,\n  TFetchSingleUserFailedActionCreator,\n  TRemoveUserActionCreator,\n  fetchSingleUserTypes,\n  removeUserTypes\n} from \"./types\";\n\nexport const fetchSingleUserRequested: TFetchSingleUserRequestedActionCreator = id => {\n  return {\n    type: fetchSingleUserTypes.FETCH_SINGLE_USER_REQUESTED,\n    id\n  };\n};\n\nexport const fetchSingleUserSucceeded: TFetchSingleUserSucceededActionCreator = user => {\n  return {\n    type: fetchSingleUserTypes.FETCH_SINGLE_USER_SUCCEEDED,\n    user\n  };\n};\n\nexport const fetchSingleUserFailed: TFetchSingleUserFailedActionCreator = error => {\n  return {\n    type: fetchSingleUserTypes.FETCH_SINGLE_USER_FAILED,\n    error\n  };\n};\n\nexport const removeUser: TRemoveUserActionCreator = id => {\n  return {\n    type: removeUserTypes.REMOVE_USER,\n    id\n  };\n};\n","import axios from \"axios\";\n\nimport { TUser } from \"../../../types\";\nimport { TUserModel } from \"../../../../server/models/User/types\";\n\nexport const fetchSingleUser = (id: string) => {\n  if (__CLIENT__) {\n    return axios.get<TUser>(`/api/${id}`).then(res => {\n      return res.data;\n    });\n  } else if (__SERVER__) {\n    const User = require(\"../../../../server/models/User\")\n      .default as TUserModel;\n\n    return User.findById(id, User.publicFields)\n      .lean()\n      .then((user: TUser) => {\n        user._id = user._id.toString();\n        return user;\n      });\n  }\n};\n\nexport const removeUser = (id: string) => {\n  return axios.delete(`/api/delete/${id}`);\n};\n","import React, { SFC } from \"react\";\nimport { withTheme } from \"styledComponents\";\n\nimport { TArrowBackProps } from \"./types\";\n\nconst ArrowBack: SFC<TArrowBackProps> = ({\n  theme,\n  width = 18,\n  height = 18\n}) => {\n  return (\n    <svg width={width} height={height} xmlns=\"http://www.w3.org/2000/svg\">\n      <path\n        d=\"M18 7.895v2.21H4.311l6.279 6.305L9 18 0 9l9-9 1.59 1.59L4.31 7.895z\"\n        fill={theme.colors.tertiary}\n        fillRule=\"evenodd\"\n      />\n    </svg>\n  );\n};\n\nexport default withTheme(ArrowBack);\n","import styled from \"styledComponents\";\nimport { rgba } from \"polished\";\nimport { Link } from \"react-router-dom\";\n\nexport const Card = styled.article`\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  background-color: white;\n  border-radius: ${({ theme }) => theme.scale.first};\n  padding: ${({ theme }) => theme.scale.first};\n  box-shadow: 0 4px 16px ${({ theme }) => rgba(theme.colors.quaternary, 0.54)};\n`;\n\nexport const FullName = styled.h2`\n  margin: 0;\n  font-size: ${({ theme }) => theme.scale.second};\n  color: rgba(0, 0, 0 0.87);\n  font-weight: normal;\n`;\n\nexport const Username = styled.h3`\n  margin: 0;\n  color: rgba(0, 0, 0, 0.54);\n  font-weight: normal;\n`;\n\nexport const Email = styled.p`\n  margin: ${({ theme }) => theme.scale.second} 0 0 0;\n  color: rgba(0, 0, 0, 0.54);\n  span {\n    font-weight: bold;\n  }\n`;\n\nexport const RegisteredSince = styled.p`\n  margin: ${({ theme }) => theme.scale.first} 0 0 0;\n  color: rgba(0, 0, 0, 0.54);\n  span {\n    font-weight: bold;\n  }\n`;\n\nexport const Buttons = styled.section`\n  align-self: stretch;\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  margin-top: ${({ theme }) => theme.scale.third};\n`;\n\nexport const BaseButton = styled(Link)`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-basis: ${({ theme }) => theme.scale.fifth};\n  height: ${({ theme }) => theme.scale.second};\n  border: none;\n  border-radius: ${({ theme }) => theme.scale.second};\n  color: white;\n  font-size: ${({ theme }) => theme.scale.base};\n  text-decoration: none;\n  :last-child {\n    margin-left: ${({ theme }) => theme.scale.second};\n  }\n  padding: 0;\n`;\n\nexport const EditButton = BaseButton.extend`\n  background-color: ${({ theme }) => theme.colors.tertiary};\n`;\n\nexport const DeleteButton = BaseButton.withComponent(\"button\").extend`\n  background-color: ${({ theme }) => theme.colors.secondary};\n  cursor: pointer;\n`;\n\nexport const BackButton = styled(Link)`\n  display: flex;\n  justify-content: space-around;\n  align-items: center;\n  margin-bottom: ${({ theme }) => theme.scale.first};\n  width: ${({ theme }) => theme.scale.fourth};\n  height: ${({ theme }) => theme.scale.second};\n  border: 2px solid ${({ theme }) => theme.colors.tertiary};\n  border-radius: ${({ theme }) => theme.scale.second};\n  text-decoration: none;\n  color: ${({ theme }) => theme.colors.tertiary};\n  opacity: 0.6;\n  transition: opacity 100ms;\n  :hover {\n    opacity: 1;\n    background-color: rgba(255, 255, 255, 0.6);\n  }\n`;\n","import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { Redirect } from \"react-router-dom\";\n\nimport {\n  Card,\n  FullName,\n  Username,\n  Email,\n  RegisteredSince,\n  Buttons,\n  EditButton,\n  DeleteButton,\n  BackButton\n} from \"./components/styled\";\nimport ArrowBack from \"./components/ArrowBack\";\nimport * as actionCreators from \"./actionCreators\";\nimport { removeLoggedInUser } from \"../../../actionCreators\";\n\nimport { TSingleUserProps, TOwnProps } from \"./types\";\nimport { TGlobalState, TUser } from \"../../../types\";\n\nclass SingleUser extends Component<TSingleUserProps> {\n  constructor(props: TSingleUserProps) {\n    super(props);\n\n    if (__SERVER__) props.fetchSingleUserRequested(this.props.match.params.id);\n  }\n\n  removeUser = () => {\n    const {\n      history,\n      match: {\n        params: { id }\n      },\n      removeUser,\n      removeLoggedInUser\n    } = this.props;\n    removeUser(id);\n    removeLoggedInUser();\n    history.push(\"/login\");\n  };\n\n  render() {\n    const {\n      users,\n      match: {\n        params: { id: idUrlParam }\n      }\n    } = this.props;\n\n    if (!/^[0-9a-fA-F]{24}$/.test(idUrlParam) || !users.length) {\n      return <Redirect to=\"/\" />;\n    }\n\n    const { firstName, lastName, username, email, createdAt } = users.find(\n      user => user._id === idUrlParam\n    )!;\n    const { _id: loggedInUserId } = this.props.loggedInUser!;\n\n    return (\n      <>\n        <BackButton to=\"/\">\n          <ArrowBack />\n          <p>Back</p>\n        </BackButton>\n        <Card>\n          {firstName || lastName ? (\n            <>\n              <FullName>\n                {firstName} {lastName}\n              </FullName>\n              <Username>@{username}</Username>\n            </>\n          ) : (\n            <FullName>@{username}</FullName>\n          )}\n          <Email>\n            <span>Email:</span> {email}\n          </Email>\n          <RegisteredSince>\n            <span>Registered since: </span>\n            {new Date(createdAt).toDateString()}\n          </RegisteredSince>\n          {loggedInUserId === idUrlParam && (\n            <Buttons>\n              <EditButton to={`/${idUrlParam}/edit`}>Edit profile</EditButton>\n              {/* the \"to\" attribute is for solving a type issue */}\n              <DeleteButton to=\"\" onClick={this.removeUser}>\n                Delete account\n              </DeleteButton>\n            </Buttons>\n          )}\n        </Card>\n      </>\n    );\n  }\n}\n\nexport default connect(state => state, {\n  ...actionCreators,\n  removeLoggedInUser\n})(SingleUser);\n","import { TGlobalState } from \"../../../types\";\nimport {\n  TFetchSingleUserActions,\n  TRemoveUserAction,\n  fetchSingleUserTypes,\n  removeUserTypes\n} from \"./types\";\n\nexport default function singleUserReducer(\n  state: TGlobalState,\n  action: TFetchSingleUserActions | TRemoveUserAction\n) {\n  switch (action.type) {\n    case fetchSingleUserTypes.FETCH_SINGLE_USER_REQUESTED:\n      return { ...state, requestInProgress: true };\n    case fetchSingleUserTypes.FETCH_SINGLE_USER_SUCCEEDED:\n      return {\n        ...state,\n        users: [...state.users, { ...action.user }],\n        requestInProgress: false\n      };\n    case fetchSingleUserTypes.FETCH_SINGLE_USER_FAILED:\n      return { ...state, error: action.error, requestInProgress: false };\n\n    case removeUserTypes.REMOVE_USER:\n      const { users } = state;\n      const idx = users.findIndex(user => user._id === action.id);\n      return {\n        ...state,\n        users: [...users.slice(0, idx), ...users.slice(idx + 1)]\n      };\n\n    default:\n      return state;\n  }\n}\n","import { takeLatest, call, put, all } from \"redux-saga/effects\";\n\nimport { fetchSingleUser, removeUser } from \"./apiService\";\nimport {\n  fetchSingleUserSucceeded,\n  fetchSingleUserFailed\n} from \"./actionCreators\";\n\nimport {\n  fetchSingleUserTypes,\n  removeUserTypes,\n  TFetchSingleUserActions,\n  TRemoveUserAction\n} from \"./types\";\n\nexport function* fetchSingleUserWorker(action: TFetchSingleUserActions) {\n  if (action.type === fetchSingleUserTypes.FETCH_SINGLE_USER_REQUESTED) {\n    try {\n      const user = yield call(fetchSingleUser, action.id);\n      yield put(fetchSingleUserSucceeded(user));\n    } catch (error) {\n      yield put(fetchSingleUserFailed(error));\n    }\n  }\n}\n\nexport function* removeUserWorker(action: TRemoveUserAction) {\n  try {\n    yield call(removeUser, action.id);\n  } catch (e) {\n    console.error(e);\n  }\n}\n\nexport default function* watchFetchSingleUser() {\n  yield all([\n    takeLatest(\n      fetchSingleUserTypes.FETCH_SINGLE_USER_REQUESTED,\n      fetchSingleUserWorker\n    ),\n    takeLatest(removeUserTypes.REMOVE_USER, removeUserWorker)\n  ]);\n}\n","import { RouteComponentProps } from \"react-router-dom\";\nimport {\n  TUser,\n  TGlobalState,\n  TRemoveLoggedInUserActionCreator\n} from \"../../../types\";\n\nexport interface TSingleUserProps\n  extends TGlobalState,\n    RouteComponentProps<{ id: string }> {\n  fetchSingleUserRequested: TFetchSingleUserRequestedActionCreator;\n  fetchSingleUserSucceeded: TFetchSingleUserSucceededActionCreator;\n  fetchSingleUserFailed: TFetchSingleUserFailedActionCreator;\n  removeUser: TRemoveUserActionCreator;\n  removeLoggedInUser: TRemoveLoggedInUserActionCreator;\n}\n\nexport interface TOwnProps extends RouteComponentProps<{ id: string }> {}\n\nexport enum fetchSingleUserTypes {\n  FETCH_SINGLE_USER_REQUESTED = \"FETCH_SINGLE_USER_REQUESTED\",\n  FETCH_SINGLE_USER_SUCCEEDED = \"FETCH_SINGLE_USER_SUCCEEDED\",\n  FETCH_SINGLE_USER_FAILED = \"FETCH_SINGLE_USER_FAILED\"\n}\n\nexport interface TFetchSingleUserRequestedAction {\n  type: fetchSingleUserTypes.FETCH_SINGLE_USER_REQUESTED;\n  id: string;\n}\nexport interface TFetchSingleUserSucceededAction {\n  type: fetchSingleUserTypes.FETCH_SINGLE_USER_SUCCEEDED;\n  user: TUser;\n}\nexport interface TFetchSingleUserFailedAction {\n  type: fetchSingleUserTypes.FETCH_SINGLE_USER_FAILED;\n  error: Error;\n}\nexport type TFetchSingleUserActions =\n  | TFetchSingleUserRequestedAction\n  | TFetchSingleUserSucceededAction\n  | TFetchSingleUserFailedAction;\n\nexport interface TFetchSingleUserRequestedActionCreator {\n  (id: string): TFetchSingleUserRequestedAction;\n}\nexport interface TFetchSingleUserSucceededActionCreator {\n  (user: TUser): TFetchSingleUserSucceededAction;\n}\nexport interface TFetchSingleUserFailedActionCreator {\n  (error: Error): TFetchSingleUserFailedAction;\n}\n\n/**\n * REMOVE USER\n */\n\nexport enum removeUserTypes {\n  REMOVE_USER = \"REMOVE_USER\"\n}\n\nexport interface TRemoveUserAction {\n  type: removeUserTypes.REMOVE_USER;\n  id: string;\n}\n\nexport interface TRemoveUserActionCreator {\n  (id: string): TRemoveUserAction;\n}\n","import {\n  TUsersFetchRequestedActionCreator,\n  TUsersFetchSucceededActionCreator,\n  TUsersFetchFailedActionCreator,\n  UsersFetchActionTypes\n} from \"./types\";\n\nexport const usersFetchRequested: TUsersFetchRequestedActionCreator = () => {\n  return {\n    type: UsersFetchActionTypes.USERS_FETCH_REQUESTED\n  };\n};\nexport const usersFetchSucceeded: TUsersFetchSucceededActionCreator = users => {\n  return {\n    type: UsersFetchActionTypes.USERS_FETCH_SUCCEEDED,\n    users\n  };\n};\nexport const usersFetchFailed: TUsersFetchFailedActionCreator = error => {\n  return {\n    type: UsersFetchActionTypes.USERS_FETCH_FAILED,\n    error\n  };\n};\n","import axios from \"axios\";\nimport pick from \"lodash/pick\";\n\nimport {\n  TUserDocument,\n  TUserModel\n} from \"../../../../server/models/User/types\";\nimport { TUser } from \"../../../types\";\n\nexport const fetchUsers = () => {\n  if (__CLIENT__) {\n    return axios.get(\"/api/\").then(res => res.data);\n  } else if (__SERVER__) {\n    const User = require(\"../../../../server/models/User\")\n      .default as TUserModel;\n\n    return User.find({}, User.publicFields)\n      .lean()\n      .then((users: TUser[]) => {\n        return users.map(user => {\n          user._id = user._id.toString();\n          return user;\n        });\n      });\n  }\n};\n","import React, { SFC } from \"react\";\nimport styled from \"styledComponents\";\n\nimport { TIsLoggedInUserProps } from \"./types\";\n\nconst ThisIsYou = styled.p`\n  display: inline-block;\n  margin: 0;\n  font-size: ${({ theme }) => theme.scale.base};\n  font-style: italic;\n  font-weight: normal;\n  color: ${({ theme }) => theme.colors.quaternary};\n`;\n\nconst IsLoggedInUser: SFC<TIsLoggedInUserProps> = ({\n  loggedInUserId,\n  userId\n}) => {\n  return loggedInUserId === userId ? (\n    <ThisIsYou> &nbsp; — this is you</ThisIsYou>\n  ) : null;\n};\n\nexport default IsLoggedInUser;\n","import styled from \"styledComponents\";\nimport { rgba, stripUnit } from \"polished\";\nimport { Link } from \"react-router-dom\";\n\nimport { TFullNameProps } from \"./types\";\n\nexport const Card = styled(Link)`\n  flex-basis: 100%;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  height: ${({ theme }) => theme.scale.third};\n  padding: 0 ${({ theme }) => theme.scale.first} 0;\n  :not(:first-child) {\n    margin-top: ${({ theme }) => theme.scale.first};\n  }\n  box-shadow: 0 4px 16px ${({ theme }) => rgba(theme.colors.quaternary, 0.54)};\n  text-decoration: none;\n  border: 2px solid transparent;\n  :hover {\n    border: 2px solid ${({ theme }) => theme.colors.primary};\n  }\n  background-color: white;\n  border-radius: ${({ theme }) => theme.scale.mFirst};\n`;\n\nexport const FullName = styled<TFullNameProps, \"h2\">(\"h2\")`\n  display: block;\n  margin: 0;\n  font-size: ${({ theme }) => theme.scale.base};\n  font-weight: ${({ bold }) => (bold ? \"bold\" : \"normal\")}\n  color: rgba(0, 0, 0, 0.87);\n`;\n\nexport const Username = styled.h3`\n  display: block;\n  margin: 0;\n  font-size: ${({ theme }) => theme.scale.base};\n  font-weight: 100;\n  color: rgba(0, 0, 0, 0.54);\n`;\n","import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { Redirect } from \"react-router-dom\";\n\nimport * as actionCreators from \"./actionCreators\";\nimport { Card, FullName, Username } from \"./components/styled\";\nimport IsLoggedInUser from \"./components/IsLoggedInUser\";\n\nimport { TUserListProps } from \"./types\";\n\nclass UserList extends Component<TUserListProps> {\n  constructor(props: TUserListProps) {\n    super(props);\n    if (this.props.loggedInUser) this.props.usersFetchRequested();\n  }\n\n  render() {\n    if (this.props.loggedInUser) {\n      const { loggedInUser, users } = this.props;\n      const loggedInUserId = loggedInUser._id;\n\n      return users.map(user => {\n        const { firstName, lastName, username } = user;\n        let userId = user._id;\n        return (\n          <Card key={userId} to={`/${userId}`}>\n            {firstName || lastName ? (\n              <>\n                <FullName bold={loggedInUserId === userId}>\n                  {firstName} {lastName}\n                  <IsLoggedInUser\n                    loggedInUserId={loggedInUserId}\n                    userId={userId}\n                  />\n                </FullName>\n                <Username>@{username}</Username>\n              </>\n            ) : (\n              <FullName bold={loggedInUserId === userId}>\n                @{username}\n                <IsLoggedInUser\n                  loggedInUserId={loggedInUserId}\n                  userId={userId}\n                />\n              </FullName>\n            )}\n          </Card>\n        );\n      });\n    } else {\n      return <Redirect to=\"/login\" />;\n    }\n  }\n}\n\nexport default connect(state => state, actionCreators)(UserList);\n","import { UsersFetchActionTypes, TUsersFetchActions } from \"./types\";\nimport { TGlobalState } from \"../../../types\";\n\nexport default function userList(\n  state: TGlobalState,\n  action: TUsersFetchActions\n) {\n  switch (action.type) {\n    case UsersFetchActionTypes.USERS_FETCH_REQUESTED:\n      return { ...state, requestInProgress: true };\n    case UsersFetchActionTypes.USERS_FETCH_SUCCEEDED:\n      return { ...state, users: action.users, requestInProgress: false };\n    case UsersFetchActionTypes.USERS_FETCH_FAILED:\n      return { ...state, error: action.error, requestInProgress: false };\n    default:\n      return state;\n  }\n}\n","import { takeLatest, call, put } from \"redux-saga/effects\";\nimport { fetchUsers as fetchUsersApi } from \"./apiService\";\nimport { UsersFetchActionTypes } from \"./types\";\n\nexport function* fetchUsers() {\n  try {\n    const users = yield call(fetchUsersApi);\n    yield put({ type: UsersFetchActionTypes.USERS_FETCH_SUCCEEDED, users });\n  } catch (error) {\n    yield put({ type: UsersFetchActionTypes.USERS_FETCH_FAILED, error });\n  }\n}\n\nexport default function* userListSaga() {\n  yield takeLatest(UsersFetchActionTypes.USERS_FETCH_REQUESTED, fetchUsers);\n}\n","import { TUser } from \"../../../types\";\nimport { RouteComponentProps } from \"react-router-dom\";\nimport { TGlobalState } from \"../../../types\";\n\nexport interface TUserListProps extends TGlobalState, RouteComponentProps<{}> {\n  readonly usersFetchRequested: TUsersFetchRequestedActionCreator;\n  readonly usersFetchSucceeded: TUsersFetchSucceededActionCreator;\n  readonly usersFetchFailed: TUsersFetchFailedActionCreator;\n}\n\nexport enum UsersFetchActionTypes {\n  USERS_FETCH_REQUESTED = \"USERS_FETCH_REQUESTED\",\n  USERS_FETCH_SUCCEEDED = \"USERS_FETCH_SUCCEEDED\",\n  USERS_FETCH_FAILED = \"USERS_FETCH_FAILED\"\n}\n\nexport interface TUsersFetchRequestedAction {\n  readonly type: UsersFetchActionTypes.USERS_FETCH_REQUESTED;\n}\nexport interface TUsersFetchSucceededAction {\n  readonly type: UsersFetchActionTypes.USERS_FETCH_SUCCEEDED;\n  readonly users: TUser[];\n}\nexport interface TUsersFetchFailedAction {\n  readonly type: UsersFetchActionTypes.USERS_FETCH_FAILED;\n  readonly error: Error;\n}\nexport type TUsersFetchActions =\n  | TUsersFetchRequestedAction\n  | TUsersFetchSucceededAction\n  | TUsersFetchFailedAction;\n\nexport interface TUsersFetchRequestedActionCreator {\n  (): TUsersFetchRequestedAction;\n}\nexport interface TUsersFetchSucceededActionCreator {\n  (users: TUser[]): TUsersFetchSucceededAction;\n}\nexport interface TUsersFetchFailedActionCreator {\n  (err: Error): TUsersFetchFailedAction;\n}\n","import {\n  TAddLoggedInUserActionCreator,\n  TRemoveLoggedInUserActionCreator,\n  loggedInUserTypes\n} from \"./types\";\n\nexport const addLoggedInUser: TAddLoggedInUserActionCreator = user => {\n  return {\n    type: loggedInUserTypes.ADD_LOGGED_IN_USER,\n    user\n  };\n};\n\nexport const removeLoggedInUser: TRemoveLoggedInUserActionCreator = () => {\n  return {\n    type: loggedInUserTypes.REMOVE_LOGGED_IN_USER\n  };\n};\n","import { createStore, compose, StoreEnhancer, applyMiddleware } from \"redux\";\nimport createSagaMiddleware, { END } from \"redux-saga\";\n\nimport rootReducer from \"./rootReducer\";\n\nimport { TGlobalState, TCustomStore } from \"./types\";\n\nexport const defaultState: TGlobalState = {\n  users: [],\n  loggedInUser: null,\n  requestInProgress: false,\n  error: null\n};\n\nexport default function configureStore(preloadedState = defaultState) {\n  const enhancers: StoreEnhancer<TGlobalState>[] = [];\n\n  const sagaMiddleware = createSagaMiddleware();\n  enhancers.push(applyMiddleware(sagaMiddleware));\n\n  if (\n    process.env.NODE_ENV === \"development\" &&\n    typeof window === \"object\" &&\n    typeof window.__REDUX_DEVTOOLS_EXTENSION__ === \"function\"\n  ) {\n    enhancers.push(window.__REDUX_DEVTOOLS_EXTENSION__());\n  }\n\n  const store = createStore(\n    rootReducer,\n    preloadedState,\n    compose(...enhancers)\n  ) as TCustomStore<TGlobalState>;\n\n  store.runSaga = sagaMiddleware.run;\n  store.close = () => store.dispatch(END);\n\n  return store;\n}\n","import { injectGlobal } from \"styledComponents\";\n\ninjectGlobal`\n  * {\n    box-sizing: border-box;\n  }\n\n  html, body {\n    height: 100%;\n    margin: 0;\n    font-family: \"Inter UI\", sans-serif;\n  }\n  \n  #root {\n    display: flex;\n    height: 100%;\n    flex-direction: column;\n  }\n`;\n","import userListReducer from \"./Root/screens/UserList/reducers\";\nimport singleUserReducer from \"./Root/screens/SingleUser/reducers\";\nimport editProfileReducer from \"./Root/screens/EditProfile/reducers\";\n\nimport {\n  TUsersFetchActions,\n  UsersFetchActionTypes\n} from \"./Root/screens/UserList/types\";\nimport {\n  TGlobalState,\n  TUser,\n  loggedInUserTypes,\n  TLoggedInUserActionTypes\n} from \"./types\";\nimport {\n  fetchSingleUserTypes,\n  TFetchSingleUserActions\n} from \"./Root/screens/SingleUser/types\";\nimport {\n  TUserUpdateSucceededAction,\n  userUpdateTypes\n} from \"./Root/screens/EditProfile/types\";\n\ntype ActionTypes =\n  | TLoggedInUserActionTypes\n  | TUsersFetchActions\n  | TFetchSingleUserActions\n  | TUserUpdateSucceededAction;\n\nexport default function rootReducer(state: TGlobalState, action: ActionTypes) {\n  switch (action.type) {\n    case loggedInUserTypes.ADD_LOGGED_IN_USER:\n      return { ...state, loggedInUser: action.user };\n    case loggedInUserTypes.REMOVE_LOGGED_IN_USER:\n      return { ...state, loggedInUser: null };\n\n    case UsersFetchActionTypes.USERS_FETCH_REQUESTED:\n    case UsersFetchActionTypes.USERS_FETCH_SUCCEEDED:\n    case UsersFetchActionTypes.USERS_FETCH_FAILED:\n      return userListReducer(state, action);\n\n    case fetchSingleUserTypes.FETCH_SINGLE_USER_REQUESTED:\n    case fetchSingleUserTypes.FETCH_SINGLE_USER_SUCCEEDED:\n    case fetchSingleUserTypes.FETCH_SINGLE_USER_FAILED:\n      return singleUserReducer(state, action);\n\n    case userUpdateTypes.USER_UPDATE_SUCCEEDED:\n      return editProfileReducer(state, action);\n\n    default:\n      return state;\n  }\n}\n","import { all, fork } from \"redux-saga/effects\";\n\nimport userListSaga from \"./Root/screens/UserList/sagas\";\nimport singleUserSaga from \"./Root/screens/SingleUser/sagas\";\nimport editProfileSaga from \"./Root/screens/EditProfile/sagas\";\n\nexport default function* rootSaga() {\n  yield all([fork(userListSaga), fork(singleUserSaga), fork(editProfileSaga)]);\n}\n","import styled from \"styledComponents\";\nimport { Field, Form, FieldAttributes } from \"formik\";\nimport { Link } from \"react-router-dom\";\n\nexport const Title = styled.h1`\n  font-size: ${({ theme }) => theme.scale.second};\n  font-weight: 100;\n  color: rgba(0, 0, 0, 0.54);\n  text-align: center;\n  padding: 0 0 ${({ theme }) => theme.scale.base} 0;\n  margin: 0;\n`;\n\nexport const ServerErrorMessage = styled.p`\n  color: ${({ theme }) => theme.colors.secondary};\n  text-align: center;\n`;\n\nexport const BaseButton = styled.button`\n  display: block;\n  height: 40px;\n  width: 150px;\n  font-size: ${({ theme }) => theme.scale.base};\n  background-color: ${({ theme }) => theme.colors.primary};\n  color: white;\n  border-radius: 40px;\n  font-weight: 100;\n  border: none;\n  :disabled {\n    opacity: 0.5;\n  }\n`;\n\nexport const SubmitButton = BaseButton.extend``;\n\nexport const ErrorMessage = styled.p`\n  min-height: 40px;\n  max-width: 280px;\n  padding: 0 0 0 10px;\n  font-style: italic;\n  color: ${({ theme }) => theme.colors.secondary};\n  margin: 6px 20px 6px 0px;\n`;\n\nexport const Label = styled.label`\n  font-style: italic;\n  color: rgba(0, 0, 0, 0.54);\n  margin-left: 20px;\n  span {\n    color: ${({ theme }) => theme.colors.secondary};\n  }\n`;\n\ninterface TStyledFieldProps {\n  type: string;\n  name: string;\n  id: string;\n}\n\nexport const StyledField = styled<TStyledFieldProps>(Field)`\n  border: 2px solid ${({ theme }) => theme.colors.quaternary};\n  height: 40px;\n  width: 300px;\n  border-radius: 30px;\n  font-size: ${({ theme }) => theme.scale.base};\n  color: rgba(0, 0, 0, 0.87);\n  padding-left: 16px;\n`;\n\nexport const BottomLink = styled(Link)`\n  margin-top: ${({ theme }) => theme.scale.first};\n  font-style: italic;\n  color: ${({ theme }) => theme.colors.quaternary};\n  text-align: center;\n  :hover {\n    color: ${({ theme }) => theme.colors.tertiary};\n  }\n  align-self: stretch;\n`;\n\nexport const InputBlock = styled.div``;\n\nexport const BlockWrapper = styled.div`\n  flex-basis: 100%;\n  display: flex;\n  justify-content: center;\n`;\n\nexport const StyledForm = styled(Form)`\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-between;\n  @media (max-width: 600px) {\n    justify-content: center;\n  }\n`;\n","import * as styledComponents from \"styled-components\";\nimport { ThemedStyledComponentsModule } from \"styled-components\";\n\nimport { TTheme } from \"./types\";\n\nconst {\n  default: styled,\n  css,\n  injectGlobal,\n  keyframes,\n  ThemeProvider,\n  withTheme\n} = styledComponents as ThemedStyledComponentsModule<TTheme>;\n\nexport { css, injectGlobal, keyframes, ThemeProvider, withTheme };\nexport default styled;\n","import { modularScale } from \"polished\";\nimport { TTheme } from \"./types\";\n\nconst theme: TTheme = {\n  colors: {\n    primary: \"#58CDF7\",\n    secondary: \"#FD739F\",\n    tertiary: \"#84F4E1\",\n    quaternary: \"#D3C4D1\"\n  },\n  scale: {\n    sixth: modularScale(6, 1, \"goldenSection\"),\n    fifth: modularScale(5, 1, \"goldenSection\"),\n    fourth: modularScale(4, 1, \"goldenSection\"),\n    third: modularScale(3, 1, \"goldenSection\"),\n    second: modularScale(2, 1, \"goldenSection\"),\n    first: modularScale(1, 1, \"goldenSection\"),\n    base: modularScale(0, 1, \"goldenSection\"),\n    mFirst: modularScale(-1, 1, \"goldenSection\"),\n    mSecond: modularScale(-2, 1, \"goldenSection\")\n  }\n};\n\nexport default theme;\n","import { Types } from \"mongoose\";\nimport { Store } from \"redux\";\nimport { Task, END } from \"redux-saga\";\n\nexport interface TUser {\n  // not readonly because it is supposed to be converted from object to string and reassigned\n  _id: string;\n  readonly username: string;\n  readonly email: string;\n  readonly firstName?: string;\n  readonly lastName?: string;\n  readonly createdAt: Date;\n  readonly updatedAt: Date;\n}\n\nexport interface TGlobalState {\n  readonly users: TUser[];\n  loggedInUser: TUser | null;\n  readonly requestInProgress: boolean;\n  readonly error: Error | null;\n}\n\n// action types\n\nexport enum loggedInUserTypes {\n  ADD_LOGGED_IN_USER = \"ADD_AUTHED_USER\",\n  REMOVE_LOGGED_IN_USER = \"REMOVE_AUTHED_USER\"\n}\n\nexport interface TAddLoggedInUserAction {\n  readonly type: loggedInUserTypes.ADD_LOGGED_IN_USER;\n  readonly user: TUser;\n}\n\nexport interface TRemoveLoggedInUserAction {\n  readonly type: loggedInUserTypes.REMOVE_LOGGED_IN_USER;\n}\n\nexport type TLoggedInUserActionTypes =\n  | TAddLoggedInUserAction\n  | TRemoveLoggedInUserAction;\n\nexport interface TAddLoggedInUserActionCreator {\n  (user: TUser): TAddLoggedInUserAction;\n}\n\nexport interface TRemoveLoggedInUserActionCreator {\n  (): TRemoveLoggedInUserAction;\n}\n\nexport interface TCustomStore<T> extends Store<T> {\n  runSaga: (saga: () => Iterator<any>) => Task;\n  close: () => END;\n}\n\nexport interface TTheme {\n  readonly colors: {\n    readonly primary: string;\n    readonly secondary: string;\n    readonly tertiary: string;\n    readonly quaternary: string;\n  };\n  readonly scale: {\n    readonly sixth: string;\n    readonly fifth: string;\n    readonly fourth: string;\n    readonly third: string;\n    readonly second: string;\n    readonly first: string;\n    readonly base: string;\n    readonly mFirst: string;\n    readonly mSecond: string;\n  };\n}\n","import config from \"config\";\nimport app from \"./server\";\n\napp.listen(config.get(\"serverPort\"));\n","import \"./mongoose\";\nimport configurePassport from \"./passport\";\nimport { Application } from \"express\";\n\nexport default (app: Application) => {\n  configurePassport(app);\n};\n","import mongoose from \"mongoose\";\nimport config from \"config\";\n\nconst isDev = process.env.NODE_ENV === \"development\";\n\n// if (isDev) mongoose.set(\"debug\", true);\n\nmongoose.connect(config.get(\"dbUrl\"));\n\nmongoose.connection.on(\"error\", err => {\n  console.error(\"Connection error: \", err);\n});\n","import passport from \"passport\";\nimport {\n  Strategy as JWTStrategy,\n  ExtractJwt,\n  StrategyOptions\n} from \"passport-jwt\";\nimport { Application } from \"express\";\nimport config from \"config\";\nimport pick from \"lodash/pick\";\n\nimport User from \"../models/User\";\n\nexport default (app: Application) => {\n  app.use(passport.initialize());\n\n  const options: StrategyOptions = {\n    jwtFromRequest(req) {\n      let token = null;\n      if (req && req.signedCookies) {\n        token = req.signedCookies[\"access_token\"];\n      }\n      return token;\n    },\n    secretOrKey: config.get(\"jwt.secret\")\n  };\n\n  passport.use(\n    new JWTStrategy(options, (payload, done) => {\n      User.findById(payload.id, (err, user) => {\n        if (err) return done(err);\n        if (!user) return done(null, false);\n        return done(null, pick(user, User.publicFields));\n      });\n    })\n  );\n};\n","import mongoose, {\n  HookSyncCallback,\n  Types,\n  Schema,\n  Model,\n  Document\n} from \"mongoose\";\nimport crypto from \"crypto\";\nimport config from \"config\";\n\nimport {\n  TUserDocument,\n  TUserModel,\n  TUserSchema,\n  TUser,\n  TUserPublicFields,\n  TUserUpdateFields\n} from \"./types\";\n\nconst userSchema: TUserSchema = new mongoose.Schema({\n  username: {\n    type: String,\n    required: true,\n    minlength: 3,\n    maxlength: 30,\n    trim: true,\n    lowercase: true,\n    unique: true\n  },\n  email: {\n    type: String,\n    required: true,\n    lowercase: true,\n    maxlength: 60,\n    trim: true,\n    unique: true\n  },\n  firstName: {\n    type: String,\n    trim: true,\n    maxlength: 30\n  },\n  lastName: {\n    type: String,\n    trim: true,\n    maxlength: 30\n  },\n  password: {\n    type: String,\n    required: true,\n    minlength: 6,\n    maxlength: 30\n  },\n  salt: {\n    type: String\n  }\n});\n\nuserSchema.set(\"timestamps\", true);\n\nuserSchema.statics = {\n  publicFields: [\n    \"_id\",\n    \"username\",\n    \"firstName\",\n    \"lastName\",\n    \"email\",\n    \"createdAt\",\n    \"updatedAt\"\n  ],\n\n  updateFields: [\"username\", \"firstName\", \"lastName\", \"email\", \"password\"],\n\n  filterPublicFields(userOrUsers: any): any {\n    if (Array.isArray(userOrUsers)) {\n      return userOrUsers.map(rawUser => {\n        return this.publicFields.reduce(\n          (acc, field) => {\n            acc[field] = rawUser[field];\n            return acc;\n          },\n          {} as Pick<TUser, TUserPublicFields>\n        );\n      });\n    } else {\n      return userSchema.statics.publicFields.reduce(\n        (acc, field) => {\n          acc[field] = userOrUsers[field];\n          return acc;\n        },\n        {} as Pick<TUser, TUserPublicFields>\n      );\n    }\n  },\n\n  filterUpdateFields(user) {\n    return userSchema.statics.updateFields.reduce(\n      (acc, field) => {\n        acc[field] = user[field];\n        return acc;\n      },\n      {} as Pick<TUser, TUserUpdateFields>\n    );\n  }\n};\n\nconst { length, iterations, algorithm } = config.get(\"crypto\");\n\nuserSchema.pre<TUserDocument>(\"save\", function(next) {\n  crypto.randomBytes(length, (err, randB) => {\n    if (err) return next(err);\n\n    const salt = (this.salt = randB.toString(\"base64\"));\n\n    crypto.pbkdf2(\n      this.password,\n      salt,\n      iterations,\n      length,\n      algorithm,\n      (err, derivedKey) => {\n        if (err) return next(err);\n        this.password = derivedKey.toString(\"base64\");\n        next();\n      }\n    );\n  });\n});\n\nuserSchema.methods.checkPassword = function(password: string) {\n  return new Promise((resolve, reject) => {\n    password = password.trim();\n    if (!password)\n      return reject(new Error(\"You must provide a password to check.\"));\n\n    crypto.pbkdf2(\n      password,\n      this.salt,\n      iterations,\n      length,\n      algorithm,\n      (err, derivedKey) => {\n        if (err) return reject(err);\n        resolve(this.password === derivedKey.toString(\"base64\"));\n      }\n    );\n  });\n};\n\nexport default mongoose.model<TUserDocument, TUserModel>(\"User\", userSchema);\n","export { default as usersApi } from \"./users\";\nexport { default as ssr } from \"./ssr\";\n","import React from \"react\";\nimport { renderToString } from \"react-dom/server\";\nimport { StaticRouter } from \"react-router\";\nimport { Application, Handler, RequestHandler } from \"express\";\nimport config from \"config\";\nimport { Provider } from \"react-redux\";\nimport { ServerStyleSheet } from \"styled-components\";\nimport passport from \"passport\";\n\nimport Root from \"../../../common/Root\";\nimport configureStore, { defaultState } from \"../../../common/configureStore\";\nimport \"../../../common/globalStyles\";\nimport rootSaga from \"../../../common/rootSaga\";\n\nimport { TStaticContext } from \"./types\";\nimport { TUser } from \"../../../common/types\";\n\nconst assets: string[] = JSON.parse(CLIENT_ASSETS).filter((asset: string) =>\n  /.js$/.test(asset)\n);\n\nconst authHandler: Handler = (req, res, next) => {\n  passport.authenticate(\"jwt\", { session: false }, (err, user, info) => {\n    if (err) return next(err);\n    if (user) {\n      req.user = user;\n    }\n    next();\n  })(req, res, next);\n};\n\nconst SSRHandler: Handler = (req, res, next) => {\n  const context: TStaticContext = {};\n  const modules: string[] = [];\n  const sheet = new ServerStyleSheet();\n  const localDefaultState = { ...defaultState };\n\n  if (req.user) {\n    const { user } = req;\n    user._id = user._id.toString();\n    localDefaultState.loggedInUser = user as TUser;\n  }\n\n  const store = configureStore(localDefaultState);\n\n  const rootComp = (\n    <Provider store={store}>\n      <StaticRouter location={req.originalUrl} context={context}>\n        <Root />\n      </StaticRouter>\n    </Provider>\n  );\n\n  if (context.url) {\n    res.redirect(context.status || 301, context.url);\n  } else {\n    store.runSaga(rootSaga).done.then(() => {\n      const html = `\n        <!DOCTYPE html>\n        <html lang=\"en\">\n        \n        <head>\n          <meta charset=\"UTF-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n          <title>User accounts</title>\n          ${sheet.getStyleTags()}\n          <script>window.__INITIAL_STATE__ = ${JSON.stringify(\n            store.getState()\n          )}</script>\n        </head>\n        \n        <body>\n          <div id=\"root\">${renderToString(rootComp)}</div>\n        \n          ${assets\n            .slice()\n            .reverse()\n            .map(assetPath => {\n              return `<script src=\"${assetPath}\"></script>`;\n            })\n            .join(\"\\n\")}\n        </body>\n        </html>\n      `;\n      res.send(html);\n    });\n    renderToString(rootComp);\n    store.close();\n  }\n};\n\nexport default [authHandler, SSRHandler];\n","import { Router, RequestHandler } from \"express\";\nimport passport from \"passport\";\nimport _ from \"lodash\";\nimport jwt, { SignOptions } from \"jsonwebtoken\";\nimport config from \"config\";\nimport mongoose from \"mongoose\";\n\nimport User from \"../../models/User\";\nimport { TUser, TUserDocument } from \"../../models/User/types\";\nimport { TRequestErrorWithStatusCode } from \"./types\";\n\nconst router = Router();\n\nconst jwtAuth: RequestHandler = passport.authenticate(\"jwt\", {\n  session: false\n});\n\nconst cookieOptions = {\n  httpOnly: true,\n  expires: new Date(\n    Date.now() + Number.parseInt(config.get(\"cookies.expires\"))\n  ),\n  signed: true\n};\n\nconst jwtOptions: SignOptions = { expiresIn: config.get(\"jwt.expiresIn\") };\n\nconst validateUserIdParam: RequestHandler = (req, res, next) => {\n  if (!mongoose.Types.ObjectId.isValid(req.params.id)) {\n    const err = new Error(\"User id is invalid.\") as TRequestErrorWithStatusCode;\n    err.statusCode = 400;\n    return next(err);\n  }\n  next();\n};\n\nrouter.get(\"/\", jwtAuth, (req, res, next) => {\n  User.find()\n    .lean()\n    .then((rawUsers: TUser[]) => {\n      const filteredUsers = User.filterPublicFields(rawUsers);\n\n      res.json(filteredUsers);\n    })\n    .catch(next);\n});\n\nrouter.get(\"/:id\", jwtAuth, validateUserIdParam, (req, res, next) => {\n  const { id } = req.params;\n\n  User.findById(id)\n    .lean()\n    .then((rawUser: TUser) => {\n      const user = User.filterPublicFields(rawUser);\n      res.json(user);\n    })\n    .catch(next);\n});\n\nrouter.post(\"/:id/edit\", jwtAuth, validateUserIdParam, (req, res, next) => {\n  const { id } = req.params;\n  const body: { [key: string]: string } = {};\n\n  for (const key in req.body) {\n    if (req.body[key]) body[key] = req.body[key];\n  }\n\n  // if the user changes the password, we need to properly save it, otherwise we simply update document fields\n  if (body.password) {\n    User.findById(id)\n      .then(userDoc => {\n        userDoc!.set(body);\n        userDoc!\n          .save()\n          .then(updatedUserDoc => {\n            res.send(User.filterPublicFields(updatedUserDoc));\n          })\n          .catch(next);\n      })\n      .catch(next);\n  } else {\n    User.findByIdAndUpdate(id, body, { new: true })\n      .then(rawUser => {\n        const user = User.filterPublicFields(rawUser!) as TUser;\n        res.json(user);\n      })\n      .catch(next);\n  }\n});\n\nrouter.post(\"/registration\", (req, res, next) => {\n  const newUser = new User(req.body);\n  newUser\n    .save()\n    .then(rawUser => {\n      const user = User.filterPublicFields(rawUser);\n      const payload = { id: user._id };\n\n      jwt.sign(payload, config.get(\"jwt.secret\"), jwtOptions, (err, token) => {\n        if (err) return next(err);\n\n        res.cookie(\"access_token\", token, cookieOptions);\n        res.send(user);\n      });\n    })\n    .catch(next);\n});\n\nrouter.post(\"/login\", (req, res, next) => {\n  const {\n    body: { username, password }\n  } = req;\n\n  if (!username || !password) {\n    const err = new Error(\n      \"You must provide username and password.\"\n    ) as TRequestErrorWithStatusCode;\n    err.statusCode = 400;\n    return next(err);\n  }\n\n  User.findOne({ username }, (err, rawUser) => {\n    if (err) return next(err);\n    if (!rawUser) {\n      const err = new Error(\n        \"Incorrect username or password.\"\n      ) as TRequestErrorWithStatusCode;\n      err.statusCode = 400;\n      return next(err);\n    }\n\n    rawUser\n      .checkPassword(password)\n      .then(isCorrect => {\n        if (!isCorrect) {\n          const err = new Error(\n            \"Password is incorrect\"\n          ) as TRequestErrorWithStatusCode;\n          err.statusCode = 400;\n          return next(err);\n        }\n\n        const user = User.filterPublicFields(rawUser.toObject());\n\n        jwt.sign(\n          { id: user._id },\n          config.get(\"jwt.secret\"),\n          jwtOptions,\n          (err, token) => {\n            if (err) return next(err);\n\n            res.cookie(\"access_token\", token, cookieOptions);\n            res.json(user);\n          }\n        );\n      })\n      .catch(next);\n  });\n});\n\nrouter.post(\"/logout\", (req, res, next) => {\n  res.clearCookie(\"access_token\");\n  delete req.user;\n  res.status(200).send(\"Logged out\");\n});\n\nrouter.delete(\"/delete/:id\", jwtAuth, validateUserIdParam, (req, res, next) => {\n  const { id } = req.params;\n  User.findByIdAndRemove(id).catch(next);\n});\n\nexport default router;\n","import path from \"path\";\nimport mongoose from \"mongoose\";\nimport cookieParser from \"cookie-parser\";\nimport serveFavicon from \"serve-favicon\";\nimport config from \"config\";\nimport express, { ErrorRequestHandler } from \"express\";\n\nimport configureLibs from \"./libConfig\";\nimport { usersApi, ssr } from \"./routes\";\n\nconst app = express();\n\napp.disable(\"x-powered-by\");\n\nif (process.env.NODE_ENV === \"production\") {\n  app.use(\"/assets/\", express.static(\"public\"));\n}\n\napp.use(serveFavicon(path.resolve(\"./public/favicon.ico\")));\napp.use(\"/assets\", express.static(\"public\"));\napp.use(cookieParser(config.get(\"cookies.secret\")));\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\nconfigureLibs(app);\n\napp.use(\"/api/\", usersApi);\napp.use(\"/*\", ssr);\n\nconst errorHandler: ErrorRequestHandler = (err, req, res, next) => {\n  res.status(err.statusCode || 500).send(err.message);\n};\napp.use(errorHandler);\n\nexport default app;\n","module.exports = require(\"axios\");","module.exports = require(\"config\");","module.exports = require(\"cookie-parser\");","module.exports = require(\"crypto\");","module.exports = require(\"express\");","module.exports = require(\"formik\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"lodash/pick\");","module.exports = require(\"mongoose\");","module.exports = require(\"passport\");","module.exports = require(\"passport-jwt\");","module.exports = require(\"path\");","module.exports = require(\"polished\");","module.exports = require(\"react\");","module.exports = require(\"react-dom/server\");","module.exports = require(\"react-hot-loader\");","module.exports = require(\"react-redux\");","module.exports = require(\"react-router\");","module.exports = require(\"react-router-dom\");","module.exports = require(\"redux\");","module.exports = require(\"redux-saga\");","module.exports = require(\"redux-saga/effects\");","module.exports = require(\"serve-favicon\");","module.exports = require(\"styled-components\");","module.exports = require(\"yup\");"],"sourceRoot":""}